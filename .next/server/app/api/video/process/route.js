"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/video/process/route";
exports.ids = ["app/api/video/process/route"];
exports.modules = {

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fvideo%2Fprocess%2Froute&page=%2Fapi%2Fvideo%2Fprocess%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fvideo%2Fprocess%2Froute.ts&appDir=C%3A%5CUsers%5CDeborah%5CDocuments%5CCursor%20Projects%5Cchatpye%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CDeborah%5CDocuments%5CCursor%20Projects%5Cchatpye&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fvideo%2Fprocess%2Froute&page=%2Fapi%2Fvideo%2Fprocess%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fvideo%2Fprocess%2Froute.ts&appDir=C%3A%5CUsers%5CDeborah%5CDocuments%5CCursor%20Projects%5Cchatpye%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CDeborah%5CDocuments%5CCursor%20Projects%5Cchatpye&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_Deborah_Documents_Cursor_Projects_chatpye_src_app_api_video_process_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/video/process/route.ts */ \"(rsc)/./src/app/api/video/process/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/video/process/route\",\n        pathname: \"/api/video/process\",\n        filename: \"route\",\n        bundlePath: \"app/api/video/process/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\Deborah\\\\Documents\\\\Cursor Projects\\\\chatpye\\\\src\\\\app\\\\api\\\\video\\\\process\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_Deborah_Documents_Cursor_Projects_chatpye_src_app_api_video_process_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/video/process/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ2aWRlbyUyRnByb2Nlc3MlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnZpZGVvJTJGcHJvY2VzcyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnZpZGVvJTJGcHJvY2VzcyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNEZWJvcmFoJTVDRG9jdW1lbnRzJTVDQ3Vyc29yJTIwUHJvamVjdHMlNUNjaGF0cHllJTVDc3JjJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNEZWJvcmFoJTVDRG9jdW1lbnRzJTVDQ3Vyc29yJTIwUHJvamVjdHMlNUNjaGF0cHllJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PXN0YW5kYWxvbmUmcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNnRDtBQUM3SDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHVHQUF1RztBQUMvRztBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQzZKOztBQUU3SiIsInNvdXJjZXMiOlsid2VicGFjazovL2NoYXRweWUvPzY3NzEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcRGVib3JhaFxcXFxEb2N1bWVudHNcXFxcQ3Vyc29yIFByb2plY3RzXFxcXGNoYXRweWVcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcdmlkZW9cXFxccHJvY2Vzc1xcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJzdGFuZGFsb25lXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3ZpZGVvL3Byb2Nlc3Mvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS92aWRlby9wcm9jZXNzXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS92aWRlby9wcm9jZXNzL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcVXNlcnNcXFxcRGVib3JhaFxcXFxEb2N1bWVudHNcXFxcQ3Vyc29yIFByb2plY3RzXFxcXGNoYXRweWVcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcdmlkZW9cXFxccHJvY2Vzc1xcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS92aWRlby9wcm9jZXNzL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCwgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fvideo%2Fprocess%2Froute&page=%2Fapi%2Fvideo%2Fprocess%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fvideo%2Fprocess%2Froute.ts&appDir=C%3A%5CUsers%5CDeborah%5CDocuments%5CCursor%20Projects%5Cchatpye%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CDeborah%5CDocuments%5CCursor%20Projects%5Cchatpye&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/video/process/route.ts":
/*!********************************************!*\
  !*** ./src/app/api/video/process/route.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm/v4.js\");\n/* harmony import */ var _lib_mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/mongodb */ \"(rsc)/./src/lib/mongodb.ts\");\n/* harmony import */ var _lib_youtube__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/youtube */ \"(rsc)/./src/lib/youtube.ts\");\n/* harmony import */ var _google_generative_ai__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @google/generative-ai */ \"(rsc)/./node_modules/@google/generative-ai/dist/index.mjs\");\n/* harmony import */ var _lib_embeddings__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/embeddings */ \"(rsc)/./src/lib/embeddings.ts\");\n\n\n\n\n\n\n\n// Initialize Google AI\nconst genAI = new _google_generative_ai__WEBPACK_IMPORTED_MODULE_3__.GoogleGenerativeAI(process.env.GOOGLE_AI_KEY || \"\");\n// Process chunks in batches to avoid memory issues\nasync function processChunksInBatches(chunks, jobId, batchSize = 5) {\n    const totalChunks = chunks.length;\n    for(let i = 0; i < chunks.length; i += batchSize){\n        const batch = chunks.slice(i, i + batchSize);\n        await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.updateVideoJob)(jobId, {\n            progress: `Processing chunks ${i + 1}-${Math.min(i + batchSize, totalChunks)} of ${totalChunks}...`\n        });\n        // Process batch in parallel\n        await Promise.all(batch.map(async (chunk)=>{\n            try {\n                const embedding = await (0,_lib_embeddings__WEBPACK_IMPORTED_MODULE_4__.generateEmbedding)(chunk.textContent);\n                await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.updateTranscriptChunkEmbeddings)(jobId, chunk.chunkId, embedding);\n            } catch (error) {\n                console.error(`Error processing chunk ${chunk.chunkId}:`, error);\n            // Continue with other chunks even if one fails\n            }\n        }));\n    }\n}\nasync function processVideo(jobId, youtubeUrl) {\n    try {\n        // Update job status to processing\n        await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.updateVideoJob)(jobId, {\n            status: \"processing\",\n            progress: \"Checking video availability...\"\n        });\n        // Extract video ID\n        const videoId = (0,_lib_youtube__WEBPACK_IMPORTED_MODULE_2__.extractVideoId)(youtubeUrl);\n        if (!videoId) {\n            throw new Error(\"Invalid YouTube URL\");\n        }\n        // Check video details first\n        try {\n            const videoDetails = await (0,_lib_youtube__WEBPACK_IMPORTED_MODULE_2__.getVideoDetails)(videoId);\n            await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.updateVideoJob)(jobId, {\n                progress: `Processing video: ${videoDetails.title || \"Untitled\"}...`\n            });\n        } catch (error) {\n            console.error(\"Error fetching video details:\", error);\n            await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.updateVideoJob)(jobId, {\n                status: \"failed\",\n                transcriptStatus: \"error\",\n                progress: \"Could not verify video details. Please check if the video is available and public.\"\n            });\n            return;\n        }\n        // Try to fetch transcript, but don't fail if it's not available\n        let transcript = null;\n        try {\n            transcript = await (0,_lib_youtube__WEBPACK_IMPORTED_MODULE_2__.getYouTubeTranscript)(youtubeUrl);\n        } catch (error) {\n            console.log(\"No transcript available, will use Gemini directly:\", error);\n        // Continue processing without transcript\n        }\n        if (!transcript || transcript.length === 0) {\n            // Mark as completed without transcript - we'll use Gemini directly\n            await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.updateVideoJob)(jobId, {\n                status: \"completed\",\n                transcriptStatus: \"not_found\",\n                progress: \"Video processed. You can now chat about the video using Gemini.\"\n            });\n            return;\n        }\n        // If we have a transcript, process it\n        await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.updateVideoJob)(jobId, {\n            progress: \"Processing transcript...\"\n        });\n        // Create transcript chunks with a maximum size\n        const MAX_CHUNK_SIZE = 1000; // characters\n        const chunks = [];\n        let currentChunk = {\n            text: \"\",\n            start: 0,\n            duration: 0\n        };\n        for (const segment of transcript){\n            if (currentChunk.text.length + segment.text.length > MAX_CHUNK_SIZE) {\n                // Save current chunk if it has content\n                if (currentChunk.text) {\n                    chunks.push({\n                        jobId,\n                        chunkId: `${jobId}-${chunks.length}`,\n                        textContent: currentChunk.text.trim(),\n                        startTimestamp: currentChunk.start.toString(),\n                        endTimestamp: (currentChunk.start + currentChunk.duration).toString(),\n                        embedding: []\n                    });\n                }\n                // Start new chunk\n                currentChunk = {\n                    text: segment.text,\n                    start: segment.start,\n                    duration: segment.duration\n                };\n            } else {\n                // Add to current chunk\n                currentChunk.text += \" \" + segment.text;\n                currentChunk.duration += segment.duration;\n            }\n        }\n        // Add the last chunk if it has content\n        if (currentChunk.text) {\n            chunks.push({\n                jobId,\n                chunkId: `${jobId}-${chunks.length}`,\n                textContent: currentChunk.text.trim(),\n                startTimestamp: currentChunk.start.toString(),\n                endTimestamp: (currentChunk.start + currentChunk.duration).toString(),\n                embedding: []\n            });\n        }\n        // Only process chunks if we have them\n        if (chunks.length > 0) {\n            // Store transcript chunks\n            await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.updateVideoJob)(jobId, {\n                progress: \"Storing transcript chunks...\"\n            });\n            try {\n                await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.createTranscriptChunks)(chunks);\n                // Process chunks in batches\n                await processChunksInBatches(chunks, jobId);\n                // Update job status\n                await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.updateVideoJob)(jobId, {\n                    status: \"completed\",\n                    transcriptStatus: \"found\",\n                    progress: \"Processing complete\"\n                });\n            } catch (error) {\n                console.error(\"Error storing transcript chunks:\", error);\n                await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.updateVideoJob)(jobId, {\n                    status: \"failed\",\n                    transcriptStatus: \"error\",\n                    progress: \"Failed to store transcript chunks\"\n                });\n                throw error;\n            }\n        } else {\n            // If no chunks were created, still mark as completed\n            await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.updateVideoJob)(jobId, {\n                status: \"completed\",\n                transcriptStatus: \"not_found\",\n                progress: \"Video processed. You can now chat about the video using Gemini.\"\n            });\n        }\n    } catch (error) {\n        console.error(\"Error processing video:\", error);\n        let errorMessage = \"Error during processing\";\n        if (error instanceof Error) {\n            if (error.message.includes(\"private\")) {\n                errorMessage = \"This video is private. Please try a public video.\";\n            } else if (error.message.includes(\"restricted\")) {\n                errorMessage = \"This video is restricted. Please try a different video.\";\n            } else if (error.message.includes(\"not found\")) {\n                errorMessage = \"Video not found. Please check the URL and try again.\";\n            } else {\n                errorMessage = error.message;\n            }\n        }\n        await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.updateVideoJob)(jobId, {\n            status: \"failed\",\n            transcriptStatus: \"error\",\n            progress: errorMessage\n        });\n    }\n}\nasync function POST(request) {\n    try {\n        const { youtubeUrl, testMode = false } = await request.json();\n        if (!youtubeUrl) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"YouTube URL is required\"\n            }, {\n                status: 400\n            });\n        }\n        // Add test mode logging\n        if (testMode) {\n            console.log(\"Running in test mode\");\n            console.log(\"Input URL:\", youtubeUrl);\n        }\n        // Extract video ID\n        const videoId = (0,_lib_youtube__WEBPACK_IMPORTED_MODULE_2__.extractVideoId)(youtubeUrl);\n        if (!videoId) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Invalid YouTube URL\"\n            }, {\n                status: 400\n            });\n        }\n        if (testMode) {\n            console.log(\"Extracted video ID:\", videoId);\n        }\n        // Check if this video has been processed before\n        const collections = await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.getCollections)();\n        if (!collections.videoJobsCollection || !collections.transcriptChunksCollection) {\n            throw new Error(\"Database collections not initialized\");\n        }\n        if (testMode) {\n            console.log(\"Checking for existing job...\");\n        }\n        const existingJob = await collections.videoJobsCollection.findOne({\n            youtubeUrl,\n            status: \"completed\",\n            transcriptStatus: \"found\"\n        });\n        if (testMode) {\n            console.log(\"Existing job found:\", existingJob ? \"Yes\" : \"No\");\n        }\n        if (existingJob) {\n            // If we have an existing completed job with transcript, reuse it\n            const existingChunks = await collections.transcriptChunksCollection.find({\n                jobId: existingJob.jobId\n            }).toArray();\n            if (existingChunks && existingChunks.length > 0) {\n                // Create a new job that references the existing chunks\n                const newJobId = (0,uuid__WEBPACK_IMPORTED_MODULE_5__[\"default\"])();\n                await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.createVideoJob)({\n                    jobId: newJobId,\n                    youtubeUrl,\n                    status: \"completed\",\n                    transcriptStatus: \"found\",\n                    progress: \"Using previously processed transcript\"\n                });\n                // Copy existing chunks with new jobId\n                const newChunks = existingChunks.map((chunk, index)=>({\n                        ...chunk,\n                        _id: undefined,\n                        jobId: newJobId,\n                        chunkId: `${newJobId}-${index}`,\n                        createdAt: new Date()\n                    }));\n                try {\n                    await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.createTranscriptChunks)(newChunks);\n                    return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                        status: \"success\",\n                        message: \"Video processing completed (reused existing transcript)\",\n                        jobId: newJobId\n                    });\n                } catch (error) {\n                    console.error(\"Error creating transcript chunks:\", error);\n                    // If chunk creation fails, delete the job and throw error\n                    await collections.videoJobsCollection.deleteOne({\n                        jobId: newJobId\n                    });\n                    throw new Error(\"Failed to create transcript chunks\");\n                }\n            }\n        }\n        // If no existing job or chunks found, proceed with normal processing\n        const jobId = (0,uuid__WEBPACK_IMPORTED_MODULE_5__[\"default\"])();\n        // Create initial job record\n        const job = await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.createVideoJob)({\n            jobId,\n            youtubeUrl,\n            status: \"pending\",\n            transcriptStatus: \"processing\",\n            progress: \"Starting processing...\"\n        });\n        // Start processing in the background\n        processVideo(jobId, youtubeUrl).catch((error)=>{\n            console.error(\"Background processing error:\", error);\n        });\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            status: \"success\",\n            message: \"Video processing started\",\n            jobId\n        });\n    } catch (error) {\n        console.error(\"Error in POST endpoint:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Failed to process video\",\n            details: error instanceof Error ? error.message : \"Unknown error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS92aWRlby9wcm9jZXNzL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBMkM7QUFDUDtBQUNvRjtBQUNsQztBQUMzQjtBQUNOO0FBQ047QUFFL0MsdUJBQXVCO0FBQ3ZCLE1BQU1hLFFBQVEsSUFBSUgscUVBQWtCQSxDQUFDSSxRQUFRQyxHQUFHLENBQUNDLGFBQWEsSUFBSTtBQUVsRSxtREFBbUQ7QUFDbkQsZUFBZUMsdUJBQXVCQyxNQUFhLEVBQUVDLEtBQWEsRUFBRUMsWUFBWSxDQUFDO0lBQy9FLE1BQU1DLGNBQWNILE9BQU9JLE1BQU07SUFDakMsSUFBSyxJQUFJQyxJQUFJLEdBQUdBLElBQUlMLE9BQU9JLE1BQU0sRUFBRUMsS0FBS0gsVUFBVztRQUNqRCxNQUFNSSxRQUFRTixPQUFPTyxLQUFLLENBQUNGLEdBQUdBLElBQUlIO1FBQ2xDLE1BQU1oQiw0REFBY0EsQ0FBQ2UsT0FBTztZQUMxQk8sVUFBVSxDQUFDLGtCQUFrQixFQUFFSCxJQUFJLEVBQUUsQ0FBQyxFQUFFSSxLQUFLQyxHQUFHLENBQUNMLElBQUlILFdBQVdDLGFBQWEsSUFBSSxFQUFFQSxZQUFZLEdBQUcsQ0FBQztRQUNyRztRQUVBLDRCQUE0QjtRQUM1QixNQUFNUSxRQUFRQyxHQUFHLENBQUNOLE1BQU1PLEdBQUcsQ0FBQyxPQUFPQztZQUNqQyxJQUFJO2dCQUNGLE1BQU1DLFlBQVksTUFBTXRCLGtFQUFpQkEsQ0FBQ3FCLE1BQU1FLFdBQVc7Z0JBQzNELE1BQU01Qiw2RUFBK0JBLENBQUNhLE9BQU9hLE1BQU1HLE9BQU8sRUFBRUY7WUFDOUQsRUFBRSxPQUFPRyxPQUFPO2dCQUNkQyxRQUFRRCxLQUFLLENBQUMsQ0FBQyx1QkFBdUIsRUFBRUosTUFBTUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFQztZQUMxRCwrQ0FBK0M7WUFDakQ7UUFDRjtJQUNGO0FBQ0Y7QUFFQSxlQUFlRSxhQUFhbkIsS0FBYSxFQUFFb0IsVUFBa0I7SUFDM0Qs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NUIsTUFBTWdGLE1BQU0sTUFBTS9FLDREQUFjQSxDQUFDO1lBQy9CZ0I7WUFDQW9CO1lBQ0FDLFFBQVE7WUFDUkssa0JBQWtCO1lBQ2xCbkIsVUFBVTtRQUNaO1FBRUEscUNBQXFDO1FBQ3JDWSxhQUFhbkIsT0FBT29CLFlBQVk0QyxLQUFLLENBQUMvQyxDQUFBQTtZQUNwQ0MsUUFBUUQsS0FBSyxDQUFDLGdDQUFnQ0E7UUFDaEQ7UUFFQSxPQUFPcEMsa0ZBQVlBLENBQUNpRSxJQUFJLENBQUM7WUFDdkJ6QixRQUFRO1lBQ1JvQixTQUFTO1lBQ1R6QztRQUNGO0lBQ0YsRUFBRSxPQUFPaUIsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsMkJBQTJCQTtRQUN6QyxPQUFPcEMsa0ZBQVlBLENBQUNpRSxJQUFJLENBQ3RCO1lBQ0U3QixPQUFPO1lBQ1BnRCxTQUFTaEQsaUJBQWlCTSxRQUFRTixNQUFNd0IsT0FBTyxHQUFHO1FBQ3BELEdBQ0E7WUFBRXBCLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2hhdHB5ZS8uL3NyYy9hcHAvYXBpL3ZpZGVvL3Byb2Nlc3Mvcm91dGUudHM/NWQxNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IHY0IGFzIHV1aWR2NCB9IGZyb20gJ3V1aWQnO1xyXG5pbXBvcnQgeyBjcmVhdGVWaWRlb0pvYiwgdXBkYXRlVmlkZW9Kb2IsIGNyZWF0ZVRyYW5zY3JpcHRDaHVua3MsIHVwZGF0ZVRyYW5zY3JpcHRDaHVua0VtYmVkZGluZ3MgfSBmcm9tICdAL2xpYi9tb25nb2RiJztcclxuaW1wb3J0IHsgZ2V0WW91VHViZVRyYW5zY3JpcHQsIGV4dHJhY3RWaWRlb0lkLCBnZXRWaWRlb0RldGFpbHMgfSBmcm9tICdAL2xpYi95b3V0dWJlJztcclxuaW1wb3J0IHsgR29vZ2xlR2VuZXJhdGl2ZUFJIH0gZnJvbSAnQGdvb2dsZS9nZW5lcmF0aXZlLWFpJztcclxuaW1wb3J0IHsgZ2VuZXJhdGVFbWJlZGRpbmcgfSBmcm9tICdAL2xpYi9lbWJlZGRpbmdzJztcclxuaW1wb3J0IHsgZ2V0Q29sbGVjdGlvbnMgfSBmcm9tICdAL2xpYi9tb25nb2RiJztcclxuXHJcbi8vIEluaXRpYWxpemUgR29vZ2xlIEFJXHJcbmNvbnN0IGdlbkFJID0gbmV3IEdvb2dsZUdlbmVyYXRpdmVBSShwcm9jZXNzLmVudi5HT09HTEVfQUlfS0VZIHx8ICcnKTtcclxuXHJcbi8vIFByb2Nlc3MgY2h1bmtzIGluIGJhdGNoZXMgdG8gYXZvaWQgbWVtb3J5IGlzc3Vlc1xyXG5hc3luYyBmdW5jdGlvbiBwcm9jZXNzQ2h1bmtzSW5CYXRjaGVzKGNodW5rczogYW55W10sIGpvYklkOiBzdHJpbmcsIGJhdGNoU2l6ZSA9IDUpIHtcclxuICBjb25zdCB0b3RhbENodW5rcyA9IGNodW5rcy5sZW5ndGg7XHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaHVua3MubGVuZ3RoOyBpICs9IGJhdGNoU2l6ZSkge1xyXG4gICAgY29uc3QgYmF0Y2ggPSBjaHVua3Muc2xpY2UoaSwgaSArIGJhdGNoU2l6ZSk7XHJcbiAgICBhd2FpdCB1cGRhdGVWaWRlb0pvYihqb2JJZCwgeyBcclxuICAgICAgcHJvZ3Jlc3M6IGBQcm9jZXNzaW5nIGNodW5rcyAke2kgKyAxfS0ke01hdGgubWluKGkgKyBiYXRjaFNpemUsIHRvdGFsQ2h1bmtzKX0gb2YgJHt0b3RhbENodW5rc30uLi5gIFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gUHJvY2VzcyBiYXRjaCBpbiBwYXJhbGxlbFxyXG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoYmF0Y2gubWFwKGFzeW5jIChjaHVuaykgPT4ge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGVtYmVkZGluZyA9IGF3YWl0IGdlbmVyYXRlRW1iZWRkaW5nKGNodW5rLnRleHRDb250ZW50KTtcclxuICAgICAgICBhd2FpdCB1cGRhdGVUcmFuc2NyaXB0Q2h1bmtFbWJlZGRpbmdzKGpvYklkLCBjaHVuay5jaHVua0lkLCBlbWJlZGRpbmcpO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHByb2Nlc3NpbmcgY2h1bmsgJHtjaHVuay5jaHVua0lkfTpgLCBlcnJvcik7XHJcbiAgICAgICAgLy8gQ29udGludWUgd2l0aCBvdGhlciBjaHVua3MgZXZlbiBpZiBvbmUgZmFpbHNcclxuICAgICAgfVxyXG4gICAgfSkpO1xyXG4gIH1cclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc1ZpZGVvKGpvYklkOiBzdHJpbmcsIHlvdXR1YmVVcmw6IHN0cmluZykge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBVcGRhdGUgam9iIHN0YXR1cyB0byBwcm9jZXNzaW5nXHJcbiAgICBhd2FpdCB1cGRhdGVWaWRlb0pvYihqb2JJZCwgeyBzdGF0dXM6ICdwcm9jZXNzaW5nJywgcHJvZ3Jlc3M6ICdDaGVja2luZyB2aWRlbyBhdmFpbGFiaWxpdHkuLi4nIH0pO1xyXG5cclxuICAgIC8vIEV4dHJhY3QgdmlkZW8gSURcclxuICAgIGNvbnN0IHZpZGVvSWQgPSBleHRyYWN0VmlkZW9JZCh5b3V0dWJlVXJsKTtcclxuICAgIGlmICghdmlkZW9JZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgWW91VHViZSBVUkwnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDaGVjayB2aWRlbyBkZXRhaWxzIGZpcnN0XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB2aWRlb0RldGFpbHMgPSBhd2FpdCBnZXRWaWRlb0RldGFpbHModmlkZW9JZCk7XHJcbiAgICAgIGF3YWl0IHVwZGF0ZVZpZGVvSm9iKGpvYklkLCB7IFxyXG4gICAgICAgIHByb2dyZXNzOiBgUHJvY2Vzc2luZyB2aWRlbzogJHt2aWRlb0RldGFpbHMudGl0bGUgfHwgJ1VudGl0bGVkJ30uLi5gIFxyXG4gICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHZpZGVvIGRldGFpbHM6JywgZXJyb3IpO1xyXG4gICAgICBhd2FpdCB1cGRhdGVWaWRlb0pvYihqb2JJZCwgeyBcclxuICAgICAgICBzdGF0dXM6ICdmYWlsZWQnLFxyXG4gICAgICAgIHRyYW5zY3JpcHRTdGF0dXM6ICdlcnJvcicsXHJcbiAgICAgICAgcHJvZ3Jlc3M6ICdDb3VsZCBub3QgdmVyaWZ5IHZpZGVvIGRldGFpbHMuIFBsZWFzZSBjaGVjayBpZiB0aGUgdmlkZW8gaXMgYXZhaWxhYmxlIGFuZCBwdWJsaWMuJ1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFRyeSB0byBmZXRjaCB0cmFuc2NyaXB0LCBidXQgZG9uJ3QgZmFpbCBpZiBpdCdzIG5vdCBhdmFpbGFibGVcclxuICAgIGxldCB0cmFuc2NyaXB0ID0gbnVsbDtcclxuICAgIHRyeSB7XHJcbiAgICAgIHRyYW5zY3JpcHQgPSBhd2FpdCBnZXRZb3VUdWJlVHJhbnNjcmlwdCh5b3V0dWJlVXJsKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdObyB0cmFuc2NyaXB0IGF2YWlsYWJsZSwgd2lsbCB1c2UgR2VtaW5pIGRpcmVjdGx5OicsIGVycm9yKTtcclxuICAgICAgLy8gQ29udGludWUgcHJvY2Vzc2luZyB3aXRob3V0IHRyYW5zY3JpcHRcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXRyYW5zY3JpcHQgfHwgdHJhbnNjcmlwdC5sZW5ndGggPT09IDApIHtcclxuICAgICAgLy8gTWFyayBhcyBjb21wbGV0ZWQgd2l0aG91dCB0cmFuc2NyaXB0IC0gd2UnbGwgdXNlIEdlbWluaSBkaXJlY3RseVxyXG4gICAgICBhd2FpdCB1cGRhdGVWaWRlb0pvYihqb2JJZCwgeyBcclxuICAgICAgICBzdGF0dXM6ICdjb21wbGV0ZWQnLFxyXG4gICAgICAgIHRyYW5zY3JpcHRTdGF0dXM6ICdub3RfZm91bmQnLFxyXG4gICAgICAgIHByb2dyZXNzOiAnVmlkZW8gcHJvY2Vzc2VkLiBZb3UgY2FuIG5vdyBjaGF0IGFib3V0IHRoZSB2aWRlbyB1c2luZyBHZW1pbmkuJ1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHdlIGhhdmUgYSB0cmFuc2NyaXB0LCBwcm9jZXNzIGl0XHJcbiAgICBhd2FpdCB1cGRhdGVWaWRlb0pvYihqb2JJZCwgeyBwcm9ncmVzczogJ1Byb2Nlc3NpbmcgdHJhbnNjcmlwdC4uLicgfSk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRyYW5zY3JpcHQgY2h1bmtzIHdpdGggYSBtYXhpbXVtIHNpemVcclxuICAgIGNvbnN0IE1BWF9DSFVOS19TSVpFID0gMTAwMDsgLy8gY2hhcmFjdGVyc1xyXG4gICAgY29uc3QgY2h1bmtzID0gW107XHJcbiAgICBsZXQgY3VycmVudENodW5rID0ge1xyXG4gICAgICB0ZXh0OiAnJyxcclxuICAgICAgc3RhcnQ6IDAsXHJcbiAgICAgIGR1cmF0aW9uOiAwXHJcbiAgICB9O1xyXG5cclxuICAgIGZvciAoY29uc3Qgc2VnbWVudCBvZiB0cmFuc2NyaXB0KSB7XHJcbiAgICAgIGlmIChjdXJyZW50Q2h1bmsudGV4dC5sZW5ndGggKyBzZWdtZW50LnRleHQubGVuZ3RoID4gTUFYX0NIVU5LX1NJWkUpIHtcclxuICAgICAgICAvLyBTYXZlIGN1cnJlbnQgY2h1bmsgaWYgaXQgaGFzIGNvbnRlbnRcclxuICAgICAgICBpZiAoY3VycmVudENodW5rLnRleHQpIHtcclxuICAgICAgICAgIGNodW5rcy5wdXNoKHtcclxuICAgICAgICAgICAgam9iSWQsXHJcbiAgICAgICAgICAgIGNodW5rSWQ6IGAke2pvYklkfS0ke2NodW5rcy5sZW5ndGh9YCxcclxuICAgICAgICAgICAgdGV4dENvbnRlbnQ6IGN1cnJlbnRDaHVuay50ZXh0LnRyaW0oKSxcclxuICAgICAgICAgICAgc3RhcnRUaW1lc3RhbXA6IGN1cnJlbnRDaHVuay5zdGFydC50b1N0cmluZygpLFxyXG4gICAgICAgICAgICBlbmRUaW1lc3RhbXA6IChjdXJyZW50Q2h1bmsuc3RhcnQgKyBjdXJyZW50Q2h1bmsuZHVyYXRpb24pLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgIGVtYmVkZGluZzogW11cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBTdGFydCBuZXcgY2h1bmtcclxuICAgICAgICBjdXJyZW50Q2h1bmsgPSB7XHJcbiAgICAgICAgICB0ZXh0OiBzZWdtZW50LnRleHQsXHJcbiAgICAgICAgICBzdGFydDogc2VnbWVudC5zdGFydCxcclxuICAgICAgICAgIGR1cmF0aW9uOiBzZWdtZW50LmR1cmF0aW9uXHJcbiAgICAgICAgfTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBBZGQgdG8gY3VycmVudCBjaHVua1xyXG4gICAgICAgIGN1cnJlbnRDaHVuay50ZXh0ICs9ICcgJyArIHNlZ21lbnQudGV4dDtcclxuICAgICAgICBjdXJyZW50Q2h1bmsuZHVyYXRpb24gKz0gc2VnbWVudC5kdXJhdGlvbjtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEFkZCB0aGUgbGFzdCBjaHVuayBpZiBpdCBoYXMgY29udGVudFxyXG4gICAgaWYgKGN1cnJlbnRDaHVuay50ZXh0KSB7XHJcbiAgICAgIGNodW5rcy5wdXNoKHtcclxuICAgICAgICBqb2JJZCxcclxuICAgICAgICBjaHVua0lkOiBgJHtqb2JJZH0tJHtjaHVua3MubGVuZ3RofWAsXHJcbiAgICAgICAgdGV4dENvbnRlbnQ6IGN1cnJlbnRDaHVuay50ZXh0LnRyaW0oKSxcclxuICAgICAgICBzdGFydFRpbWVzdGFtcDogY3VycmVudENodW5rLnN0YXJ0LnRvU3RyaW5nKCksXHJcbiAgICAgICAgZW5kVGltZXN0YW1wOiAoY3VycmVudENodW5rLnN0YXJ0ICsgY3VycmVudENodW5rLmR1cmF0aW9uKS50b1N0cmluZygpLFxyXG4gICAgICAgIGVtYmVkZGluZzogW11cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gT25seSBwcm9jZXNzIGNodW5rcyBpZiB3ZSBoYXZlIHRoZW1cclxuICAgIGlmIChjaHVua3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAvLyBTdG9yZSB0cmFuc2NyaXB0IGNodW5rc1xyXG4gICAgICBhd2FpdCB1cGRhdGVWaWRlb0pvYihqb2JJZCwgeyBwcm9ncmVzczogJ1N0b3JpbmcgdHJhbnNjcmlwdCBjaHVua3MuLi4nIH0pO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGF3YWl0IGNyZWF0ZVRyYW5zY3JpcHRDaHVua3MoY2h1bmtzKTtcclxuXHJcbiAgICAgICAgLy8gUHJvY2VzcyBjaHVua3MgaW4gYmF0Y2hlc1xyXG4gICAgICAgIGF3YWl0IHByb2Nlc3NDaHVua3NJbkJhdGNoZXMoY2h1bmtzLCBqb2JJZCk7XHJcblxyXG4gICAgICAgIC8vIFVwZGF0ZSBqb2Igc3RhdHVzXHJcbiAgICAgICAgYXdhaXQgdXBkYXRlVmlkZW9Kb2Ioam9iSWQsIHtcclxuICAgICAgICAgIHN0YXR1czogJ2NvbXBsZXRlZCcsXHJcbiAgICAgICAgICB0cmFuc2NyaXB0U3RhdHVzOiAnZm91bmQnLFxyXG4gICAgICAgICAgcHJvZ3Jlc3M6ICdQcm9jZXNzaW5nIGNvbXBsZXRlJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHN0b3JpbmcgdHJhbnNjcmlwdCBjaHVua3M6JywgZXJyb3IpO1xyXG4gICAgICAgIGF3YWl0IHVwZGF0ZVZpZGVvSm9iKGpvYklkLCB7XHJcbiAgICAgICAgICBzdGF0dXM6ICdmYWlsZWQnLFxyXG4gICAgICAgICAgdHJhbnNjcmlwdFN0YXR1czogJ2Vycm9yJyxcclxuICAgICAgICAgIHByb2dyZXNzOiAnRmFpbGVkIHRvIHN0b3JlIHRyYW5zY3JpcHQgY2h1bmtzJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBJZiBubyBjaHVua3Mgd2VyZSBjcmVhdGVkLCBzdGlsbCBtYXJrIGFzIGNvbXBsZXRlZFxyXG4gICAgICBhd2FpdCB1cGRhdGVWaWRlb0pvYihqb2JJZCwge1xyXG4gICAgICAgIHN0YXR1czogJ2NvbXBsZXRlZCcsXHJcbiAgICAgICAgdHJhbnNjcmlwdFN0YXR1czogJ25vdF9mb3VuZCcsXHJcbiAgICAgICAgcHJvZ3Jlc3M6ICdWaWRlbyBwcm9jZXNzZWQuIFlvdSBjYW4gbm93IGNoYXQgYWJvdXQgdGhlIHZpZGVvIHVzaW5nIEdlbWluaS4nXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIHZpZGVvOicsIGVycm9yKTtcclxuICAgIGxldCBlcnJvck1lc3NhZ2UgPSAnRXJyb3IgZHVyaW5nIHByb2Nlc3NpbmcnO1xyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICBpZiAoZXJyb3IubWVzc2FnZS5pbmNsdWRlcygncHJpdmF0ZScpKSB7XHJcbiAgICAgICAgZXJyb3JNZXNzYWdlID0gJ1RoaXMgdmlkZW8gaXMgcHJpdmF0ZS4gUGxlYXNlIHRyeSBhIHB1YmxpYyB2aWRlby4nO1xyXG4gICAgICB9IGVsc2UgaWYgKGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ3Jlc3RyaWN0ZWQnKSkge1xyXG4gICAgICAgIGVycm9yTWVzc2FnZSA9ICdUaGlzIHZpZGVvIGlzIHJlc3RyaWN0ZWQuIFBsZWFzZSB0cnkgYSBkaWZmZXJlbnQgdmlkZW8uJztcclxuICAgICAgfSBlbHNlIGlmIChlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdub3QgZm91bmQnKSkge1xyXG4gICAgICAgIGVycm9yTWVzc2FnZSA9ICdWaWRlbyBub3QgZm91bmQuIFBsZWFzZSBjaGVjayB0aGUgVVJMIGFuZCB0cnkgYWdhaW4uJztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBlcnJvck1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgdXBkYXRlVmlkZW9Kb2Ioam9iSWQsIHtcclxuICAgICAgc3RhdHVzOiAnZmFpbGVkJyxcclxuICAgICAgdHJhbnNjcmlwdFN0YXR1czogJ2Vycm9yJyxcclxuICAgICAgcHJvZ3Jlc3M6IGVycm9yTWVzc2FnZVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgeW91dHViZVVybCwgdGVzdE1vZGUgPSBmYWxzZSB9ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XHJcbiAgICBcclxuICAgIGlmICgheW91dHViZVVybCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ1lvdVR1YmUgVVJMIGlzIHJlcXVpcmVkJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFkZCB0ZXN0IG1vZGUgbG9nZ2luZ1xyXG4gICAgaWYgKHRlc3RNb2RlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdSdW5uaW5nIGluIHRlc3QgbW9kZScpO1xyXG4gICAgICBjb25zb2xlLmxvZygnSW5wdXQgVVJMOicsIHlvdXR1YmVVcmwpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEV4dHJhY3QgdmlkZW8gSURcclxuICAgIGNvbnN0IHZpZGVvSWQgPSBleHRyYWN0VmlkZW9JZCh5b3V0dWJlVXJsKTtcclxuICAgIGlmICghdmlkZW9JZCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ0ludmFsaWQgWW91VHViZSBVUkwnIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRlc3RNb2RlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdFeHRyYWN0ZWQgdmlkZW8gSUQ6JywgdmlkZW9JZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgdGhpcyB2aWRlbyBoYXMgYmVlbiBwcm9jZXNzZWQgYmVmb3JlXHJcbiAgICBjb25zdCBjb2xsZWN0aW9ucyA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XHJcbiAgICBpZiAoIWNvbGxlY3Rpb25zLnZpZGVvSm9ic0NvbGxlY3Rpb24gfHwgIWNvbGxlY3Rpb25zLnRyYW5zY3JpcHRDaHVua3NDb2xsZWN0aW9uKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2UgY29sbGVjdGlvbnMgbm90IGluaXRpYWxpemVkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRlc3RNb2RlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdDaGVja2luZyBmb3IgZXhpc3Rpbmcgam9iLi4uJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZXhpc3RpbmdKb2IgPSBhd2FpdCBjb2xsZWN0aW9ucy52aWRlb0pvYnNDb2xsZWN0aW9uLmZpbmRPbmUoeyBcclxuICAgICAgeW91dHViZVVybCxcclxuICAgICAgc3RhdHVzOiAnY29tcGxldGVkJyxcclxuICAgICAgdHJhbnNjcmlwdFN0YXR1czogJ2ZvdW5kJ1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKHRlc3RNb2RlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdFeGlzdGluZyBqb2IgZm91bmQ6JywgZXhpc3RpbmdKb2IgPyAnWWVzJyA6ICdObycpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChleGlzdGluZ0pvYikge1xyXG4gICAgICAvLyBJZiB3ZSBoYXZlIGFuIGV4aXN0aW5nIGNvbXBsZXRlZCBqb2Igd2l0aCB0cmFuc2NyaXB0LCByZXVzZSBpdFxyXG4gICAgICBjb25zdCBleGlzdGluZ0NodW5rcyA9IGF3YWl0IGNvbGxlY3Rpb25zLnRyYW5zY3JpcHRDaHVua3NDb2xsZWN0aW9uLmZpbmQoeyBqb2JJZDogZXhpc3RpbmdKb2Iuam9iSWQgfSkudG9BcnJheSgpO1xyXG4gICAgICBpZiAoZXhpc3RpbmdDaHVua3MgJiYgZXhpc3RpbmdDaHVua3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyBqb2IgdGhhdCByZWZlcmVuY2VzIHRoZSBleGlzdGluZyBjaHVua3NcclxuICAgICAgICBjb25zdCBuZXdKb2JJZCA9IHV1aWR2NCgpO1xyXG4gICAgICAgIGF3YWl0IGNyZWF0ZVZpZGVvSm9iKHtcclxuICAgICAgICAgIGpvYklkOiBuZXdKb2JJZCxcclxuICAgICAgICAgIHlvdXR1YmVVcmwsXHJcbiAgICAgICAgICBzdGF0dXM6ICdjb21wbGV0ZWQnLFxyXG4gICAgICAgICAgdHJhbnNjcmlwdFN0YXR1czogJ2ZvdW5kJyxcclxuICAgICAgICAgIHByb2dyZXNzOiAnVXNpbmcgcHJldmlvdXNseSBwcm9jZXNzZWQgdHJhbnNjcmlwdCdcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gQ29weSBleGlzdGluZyBjaHVua3Mgd2l0aCBuZXcgam9iSWRcclxuICAgICAgICBjb25zdCBuZXdDaHVua3MgPSBleGlzdGluZ0NodW5rcy5tYXAoKGNodW5rLCBpbmRleCkgPT4gKHtcclxuICAgICAgICAgIC4uLmNodW5rLFxyXG4gICAgICAgICAgX2lkOiB1bmRlZmluZWQsIC8vIExldCBNb25nb0RCIGdlbmVyYXRlIG5ldyBfaWRcclxuICAgICAgICAgIGpvYklkOiBuZXdKb2JJZCxcclxuICAgICAgICAgIGNodW5rSWQ6IGAke25ld0pvYklkfS0ke2luZGV4fWAsIC8vIFVzZSBzZXF1ZW50aWFsIGluZGV4IGluc3RlYWQgb2YgcmV1c2luZyB0aGUgb2xkIGNodW5rIG51bWJlclxyXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpXHJcbiAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgYXdhaXQgY3JlYXRlVHJhbnNjcmlwdENodW5rcyhuZXdDaHVua3MpO1xyXG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgICAgICAgICAgc3RhdHVzOiAnc3VjY2VzcycsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdWaWRlbyBwcm9jZXNzaW5nIGNvbXBsZXRlZCAocmV1c2VkIGV4aXN0aW5nIHRyYW5zY3JpcHQpJyxcclxuICAgICAgICAgICAgam9iSWQ6IG5ld0pvYklkXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgdHJhbnNjcmlwdCBjaHVua3M6JywgZXJyb3IpO1xyXG4gICAgICAgICAgLy8gSWYgY2h1bmsgY3JlYXRpb24gZmFpbHMsIGRlbGV0ZSB0aGUgam9iIGFuZCB0aHJvdyBlcnJvclxyXG4gICAgICAgICAgYXdhaXQgY29sbGVjdGlvbnMudmlkZW9Kb2JzQ29sbGVjdGlvbi5kZWxldGVPbmUoeyBqb2JJZDogbmV3Sm9iSWQgfSk7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgdHJhbnNjcmlwdCBjaHVua3MnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBJZiBubyBleGlzdGluZyBqb2Igb3IgY2h1bmtzIGZvdW5kLCBwcm9jZWVkIHdpdGggbm9ybWFsIHByb2Nlc3NpbmdcclxuICAgIGNvbnN0IGpvYklkID0gdXVpZHY0KCk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGluaXRpYWwgam9iIHJlY29yZFxyXG4gICAgY29uc3Qgam9iID0gYXdhaXQgY3JlYXRlVmlkZW9Kb2Ioe1xyXG4gICAgICBqb2JJZCxcclxuICAgICAgeW91dHViZVVybCxcclxuICAgICAgc3RhdHVzOiAncGVuZGluZycsXHJcbiAgICAgIHRyYW5zY3JpcHRTdGF0dXM6ICdwcm9jZXNzaW5nJyxcclxuICAgICAgcHJvZ3Jlc3M6ICdTdGFydGluZyBwcm9jZXNzaW5nLi4uJ1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gU3RhcnQgcHJvY2Vzc2luZyBpbiB0aGUgYmFja2dyb3VuZFxyXG4gICAgcHJvY2Vzc1ZpZGVvKGpvYklkLCB5b3V0dWJlVXJsKS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0JhY2tncm91bmQgcHJvY2Vzc2luZyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICBzdGF0dXM6ICdzdWNjZXNzJyxcclxuICAgICAgbWVzc2FnZTogJ1ZpZGVvIHByb2Nlc3Npbmcgc3RhcnRlZCcsXHJcbiAgICAgIGpvYklkXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gUE9TVCBlbmRwb2ludDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgXHJcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gcHJvY2VzcyB2aWRlbycsXHJcbiAgICAgICAgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcidcclxuICAgICAgfSxcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApO1xyXG4gIH1cclxufSAiXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwidjQiLCJ1dWlkdjQiLCJjcmVhdGVWaWRlb0pvYiIsInVwZGF0ZVZpZGVvSm9iIiwiY3JlYXRlVHJhbnNjcmlwdENodW5rcyIsInVwZGF0ZVRyYW5zY3JpcHRDaHVua0VtYmVkZGluZ3MiLCJnZXRZb3VUdWJlVHJhbnNjcmlwdCIsImV4dHJhY3RWaWRlb0lkIiwiZ2V0VmlkZW9EZXRhaWxzIiwiR29vZ2xlR2VuZXJhdGl2ZUFJIiwiZ2VuZXJhdGVFbWJlZGRpbmciLCJnZXRDb2xsZWN0aW9ucyIsImdlbkFJIiwicHJvY2VzcyIsImVudiIsIkdPT0dMRV9BSV9LRVkiLCJwcm9jZXNzQ2h1bmtzSW5CYXRjaGVzIiwiY2h1bmtzIiwiam9iSWQiLCJiYXRjaFNpemUiLCJ0b3RhbENodW5rcyIsImxlbmd0aCIsImkiLCJiYXRjaCIsInNsaWNlIiwicHJvZ3Jlc3MiLCJNYXRoIiwibWluIiwiUHJvbWlzZSIsImFsbCIsIm1hcCIsImNodW5rIiwiZW1iZWRkaW5nIiwidGV4dENvbnRlbnQiLCJjaHVua0lkIiwiZXJyb3IiLCJjb25zb2xlIiwicHJvY2Vzc1ZpZGVvIiwieW91dHViZVVybCIsInN0YXR1cyIsInZpZGVvSWQiLCJFcnJvciIsInZpZGVvRGV0YWlscyIsInRpdGxlIiwidHJhbnNjcmlwdFN0YXR1cyIsInRyYW5zY3JpcHQiLCJsb2ciLCJNQVhfQ0hVTktfU0laRSIsImN1cnJlbnRDaHVuayIsInRleHQiLCJzdGFydCIsImR1cmF0aW9uIiwic2VnbWVudCIsInB1c2giLCJ0cmltIiwic3RhcnRUaW1lc3RhbXAiLCJ0b1N0cmluZyIsImVuZFRpbWVzdGFtcCIsImVycm9yTWVzc2FnZSIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsIlBPU1QiLCJyZXF1ZXN0IiwidGVzdE1vZGUiLCJqc29uIiwiY29sbGVjdGlvbnMiLCJ2aWRlb0pvYnNDb2xsZWN0aW9uIiwidHJhbnNjcmlwdENodW5rc0NvbGxlY3Rpb24iLCJleGlzdGluZ0pvYiIsImZpbmRPbmUiLCJleGlzdGluZ0NodW5rcyIsImZpbmQiLCJ0b0FycmF5IiwibmV3Sm9iSWQiLCJuZXdDaHVua3MiLCJpbmRleCIsIl9pZCIsInVuZGVmaW5lZCIsImNyZWF0ZWRBdCIsIkRhdGUiLCJkZWxldGVPbmUiLCJqb2IiLCJjYXRjaCIsImRldGFpbHMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/video/process/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/embeddings.ts":
/*!*******************************!*\
  !*** ./src/lib/embeddings.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findRelevantChunks: () => (/* binding */ findRelevantChunks),\n/* harmony export */   generateEmbedding: () => (/* binding */ generateEmbedding)\n/* harmony export */ });\n/* harmony import */ var _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/generative-ai */ \"(rsc)/./node_modules/@google/generative-ai/dist/index.mjs\");\n\nconst genAI = new _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenerativeAI(process.env.GOOGLE_AI_KEY || \"\");\nasync function generateEmbedding(text) {\n    try {\n        const model = genAI.getGenerativeModel({\n            model: \"embedding-001\"\n        });\n        const result = await model.embedContent(text);\n        const embedding = result.embedding.values;\n        return embedding;\n    } catch (error) {\n        console.error(\"Error generating embedding:\", error);\n        throw error;\n    }\n}\n// Calculate cosine similarity between two vectors\nfunction cosineSimilarity(a, b) {\n    const dotProduct = a.reduce((sum, val, i)=>sum + val * b[i], 0);\n    const magnitudeA = Math.sqrt(a.reduce((sum, val)=>sum + val * val, 0));\n    const magnitudeB = Math.sqrt(b.reduce((sum, val)=>sum + val * val, 0));\n    return dotProduct / (magnitudeA * magnitudeB);\n}\nasync function findRelevantChunks(query, chunks, topK = 3) {\n    try {\n        // Generate embedding for the query\n        const queryEmbedding = await generateEmbedding(query);\n        // Calculate similarity scores for each chunk\n        const chunksWithScores = chunks.map((chunk)=>({\n                chunk,\n                score: cosineSimilarity(queryEmbedding, chunk.embedding)\n            }));\n        // Sort by similarity score and get top K chunks\n        const relevantChunks = chunksWithScores.sort((a, b)=>b.score - a.score).slice(0, topK).map((item)=>item.chunk);\n        return relevantChunks;\n    } catch (error) {\n        console.error(\"Error finding relevant chunks:\", error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2VtYmVkZGluZ3MudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQTJEO0FBRzNELE1BQU1DLFFBQVEsSUFBSUQscUVBQWtCQSxDQUFDRSxRQUFRQyxHQUFHLENBQUNDLGFBQWEsSUFBSTtBQUUzRCxlQUFlQyxrQkFBa0JDLElBQVk7SUFDbEQsSUFBSTtRQUNGLE1BQU1DLFFBQVFOLE1BQU1PLGtCQUFrQixDQUFDO1lBQUVELE9BQU87UUFBZ0I7UUFDaEUsTUFBTUUsU0FBUyxNQUFNRixNQUFNRyxZQUFZLENBQUNKO1FBQ3hDLE1BQU1LLFlBQVlGLE9BQU9FLFNBQVMsQ0FBQ0MsTUFBTTtRQUN6QyxPQUFPRDtJQUNULEVBQUUsT0FBT0UsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsK0JBQStCQTtRQUM3QyxNQUFNQTtJQUNSO0FBQ0Y7QUFFQSxrREFBa0Q7QUFDbEQsU0FBU0UsaUJBQWlCQyxDQUFXLEVBQUVDLENBQVc7SUFDaEQsTUFBTUMsYUFBYUYsRUFBRUcsTUFBTSxDQUFDLENBQUNDLEtBQUtDLEtBQUtDLElBQU1GLE1BQU1DLE1BQU1KLENBQUMsQ0FBQ0ssRUFBRSxFQUFFO0lBQy9ELE1BQU1DLGFBQWFDLEtBQUtDLElBQUksQ0FBQ1QsRUFBRUcsTUFBTSxDQUFDLENBQUNDLEtBQUtDLE1BQVFELE1BQU1DLE1BQU1BLEtBQUs7SUFDckUsTUFBTUssYUFBYUYsS0FBS0MsSUFBSSxDQUFDUixFQUFFRSxNQUFNLENBQUMsQ0FBQ0MsS0FBS0MsTUFBUUQsTUFBTUMsTUFBTUEsS0FBSztJQUNyRSxPQUFPSCxhQUFjSyxDQUFBQSxhQUFhRyxVQUFTO0FBQzdDO0FBRU8sZUFBZUMsbUJBQ3BCQyxLQUFhLEVBQ2JDLE1BQXlCLEVBQ3pCQyxPQUFlLENBQUM7SUFFaEIsSUFBSTtRQUNGLG1DQUFtQztRQUNuQyxNQUFNQyxpQkFBaUIsTUFBTTFCLGtCQUFrQnVCO1FBRS9DLDZDQUE2QztRQUM3QyxNQUFNSSxtQkFBbUJILE9BQU9JLEdBQUcsQ0FBQ0MsQ0FBQUEsUUFBVTtnQkFDNUNBO2dCQUNBQyxPQUFPcEIsaUJBQWlCZ0IsZ0JBQWdCRyxNQUFNdkIsU0FBUztZQUN6RDtRQUVBLGdEQUFnRDtRQUNoRCxNQUFNeUIsaUJBQWlCSixpQkFDcEJLLElBQUksQ0FBQyxDQUFDckIsR0FBR0MsSUFBTUEsRUFBRWtCLEtBQUssR0FBR25CLEVBQUVtQixLQUFLLEVBQ2hDRyxLQUFLLENBQUMsR0FBR1IsTUFDVEcsR0FBRyxDQUFDTSxDQUFBQSxPQUFRQSxLQUFLTCxLQUFLO1FBRXpCLE9BQU9FO0lBQ1QsRUFBRSxPQUFPdkIsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsa0NBQWtDQTtRQUNoRCxNQUFNQTtJQUNSO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jaGF0cHllLy4vc3JjL2xpYi9lbWJlZGRpbmdzLnRzP2JjZmEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR29vZ2xlR2VuZXJhdGl2ZUFJIH0gZnJvbSAnQGdvb2dsZS9nZW5lcmF0aXZlLWFpJztcclxuaW1wb3J0IHsgVHJhbnNjcmlwdENodW5rIH0gZnJvbSAnLi9tb25nb2RiJztcclxuXHJcbmNvbnN0IGdlbkFJID0gbmV3IEdvb2dsZUdlbmVyYXRpdmVBSShwcm9jZXNzLmVudi5HT09HTEVfQUlfS0VZIHx8ICcnKTtcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUVtYmVkZGluZyh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcltdPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IG1vZGVsID0gZ2VuQUkuZ2V0R2VuZXJhdGl2ZU1vZGVsKHsgbW9kZWw6IFwiZW1iZWRkaW5nLTAwMVwiIH0pO1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbW9kZWwuZW1iZWRDb250ZW50KHRleHQpO1xyXG4gICAgY29uc3QgZW1iZWRkaW5nID0gcmVzdWx0LmVtYmVkZGluZy52YWx1ZXM7XHJcbiAgICByZXR1cm4gZW1iZWRkaW5nO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZW5lcmF0aW5nIGVtYmVkZGluZzonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuXHJcbi8vIENhbGN1bGF0ZSBjb3NpbmUgc2ltaWxhcml0eSBiZXR3ZWVuIHR3byB2ZWN0b3JzXHJcbmZ1bmN0aW9uIGNvc2luZVNpbWlsYXJpdHkoYTogbnVtYmVyW10sIGI6IG51bWJlcltdKTogbnVtYmVyIHtcclxuICBjb25zdCBkb3RQcm9kdWN0ID0gYS5yZWR1Y2UoKHN1bSwgdmFsLCBpKSA9PiBzdW0gKyB2YWwgKiBiW2ldLCAwKTtcclxuICBjb25zdCBtYWduaXR1ZGVBID0gTWF0aC5zcXJ0KGEucmVkdWNlKChzdW0sIHZhbCkgPT4gc3VtICsgdmFsICogdmFsLCAwKSk7XHJcbiAgY29uc3QgbWFnbml0dWRlQiA9IE1hdGguc3FydChiLnJlZHVjZSgoc3VtLCB2YWwpID0+IHN1bSArIHZhbCAqIHZhbCwgMCkpO1xyXG4gIHJldHVybiBkb3RQcm9kdWN0IC8gKG1hZ25pdHVkZUEgKiBtYWduaXR1ZGVCKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmRSZWxldmFudENodW5rcyhcclxuICBxdWVyeTogc3RyaW5nLFxyXG4gIGNodW5rczogVHJhbnNjcmlwdENodW5rW10sXHJcbiAgdG9wSzogbnVtYmVyID0gM1xyXG4pOiBQcm9taXNlPFRyYW5zY3JpcHRDaHVua1tdPiB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIEdlbmVyYXRlIGVtYmVkZGluZyBmb3IgdGhlIHF1ZXJ5XHJcbiAgICBjb25zdCBxdWVyeUVtYmVkZGluZyA9IGF3YWl0IGdlbmVyYXRlRW1iZWRkaW5nKHF1ZXJ5KTtcclxuXHJcbiAgICAvLyBDYWxjdWxhdGUgc2ltaWxhcml0eSBzY29yZXMgZm9yIGVhY2ggY2h1bmtcclxuICAgIGNvbnN0IGNodW5rc1dpdGhTY29yZXMgPSBjaHVua3MubWFwKGNodW5rID0+ICh7XHJcbiAgICAgIGNodW5rLFxyXG4gICAgICBzY29yZTogY29zaW5lU2ltaWxhcml0eShxdWVyeUVtYmVkZGluZywgY2h1bmsuZW1iZWRkaW5nKVxyXG4gICAgfSkpO1xyXG5cclxuICAgIC8vIFNvcnQgYnkgc2ltaWxhcml0eSBzY29yZSBhbmQgZ2V0IHRvcCBLIGNodW5rc1xyXG4gICAgY29uc3QgcmVsZXZhbnRDaHVua3MgPSBjaHVua3NXaXRoU2NvcmVzXHJcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSlcclxuICAgICAgLnNsaWNlKDAsIHRvcEspXHJcbiAgICAgIC5tYXAoaXRlbSA9PiBpdGVtLmNodW5rKTtcclxuXHJcbiAgICByZXR1cm4gcmVsZXZhbnRDaHVua3M7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZpbmRpbmcgcmVsZXZhbnQgY2h1bmtzOicsIGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufSAiXSwibmFtZXMiOlsiR29vZ2xlR2VuZXJhdGl2ZUFJIiwiZ2VuQUkiLCJwcm9jZXNzIiwiZW52IiwiR09PR0xFX0FJX0tFWSIsImdlbmVyYXRlRW1iZWRkaW5nIiwidGV4dCIsIm1vZGVsIiwiZ2V0R2VuZXJhdGl2ZU1vZGVsIiwicmVzdWx0IiwiZW1iZWRDb250ZW50IiwiZW1iZWRkaW5nIiwidmFsdWVzIiwiZXJyb3IiLCJjb25zb2xlIiwiY29zaW5lU2ltaWxhcml0eSIsImEiLCJiIiwiZG90UHJvZHVjdCIsInJlZHVjZSIsInN1bSIsInZhbCIsImkiLCJtYWduaXR1ZGVBIiwiTWF0aCIsInNxcnQiLCJtYWduaXR1ZGVCIiwiZmluZFJlbGV2YW50Q2h1bmtzIiwicXVlcnkiLCJjaHVua3MiLCJ0b3BLIiwicXVlcnlFbWJlZGRpbmciLCJjaHVua3NXaXRoU2NvcmVzIiwibWFwIiwiY2h1bmsiLCJzY29yZSIsInJlbGV2YW50Q2h1bmtzIiwic29ydCIsInNsaWNlIiwiaXRlbSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/embeddings.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/mongodb.ts":
/*!****************************!*\
  !*** ./src/lib/mongodb.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   closeDatabaseConnection: () => (/* binding */ closeDatabaseConnection),\n/* harmony export */   connectToDatabase: () => (/* binding */ connectToDatabase),\n/* harmony export */   createTranscriptChunks: () => (/* binding */ createTranscriptChunks),\n/* harmony export */   createVideoJob: () => (/* binding */ createVideoJob),\n/* harmony export */   getCachedProactiveAnalysis: () => (/* binding */ getCachedProactiveAnalysis),\n/* harmony export */   getCachedQAResponse: () => (/* binding */ getCachedQAResponse),\n/* harmony export */   getCollections: () => (/* binding */ getCollections),\n/* harmony export */   getTranscriptChunks: () => (/* binding */ getTranscriptChunks),\n/* harmony export */   getVideoJob: () => (/* binding */ getVideoJob),\n/* harmony export */   saveQAResponse: () => (/* binding */ saveQAResponse),\n/* harmony export */   updateTranscriptChunkEmbeddings: () => (/* binding */ updateTranscriptChunkEmbeddings),\n/* harmony export */   updateVideoJob: () => (/* binding */ updateVideoJob)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nconst MONGODB_URI = process.env.MONGODB_URI;\nconst MONGODB_DB_NAME = process.env.MONGODB_DB_NAME || \"chatpye_db\"; // Default DB name\nif (!MONGODB_URI) {\n    throw new Error(\"Please define the MONGODB_URI environment variable in .env.local\");\n}\nlet client = null;\nlet db = null;\nconst collections = {};\nasync function connectToDatabase() {\n    if (db && client) {\n        // TODO: Verify client connection state if possible, e.g. client.isConnected()\n        // For serverless, creating new connections per request or short-lived connections might be okay.\n        // For long-running servers, maintaining a persistent connection is better.\n        // This simple check assumes client remains connected.\n        return db;\n    }\n    if (!MONGODB_URI) {\n        throw new Error(\"MongoDB URI is not defined.\");\n    }\n    client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(MONGODB_URI, {\n        serverApi: mongodb__WEBPACK_IMPORTED_MODULE_0__.ServerApiVersion.v1,\n        tls: true,\n        tlsAllowInvalidCertificates: true,\n        tlsAllowInvalidHostnames: true,\n        maxPoolSize: 50,\n        minPoolSize: 10,\n        maxIdleTimeMS: 60000,\n        connectTimeoutMS: 30000,\n        socketTimeoutMS: 45000,\n        retryWrites: true,\n        retryReads: true,\n        directConnection: false\n    });\n    try {\n        await client.connect();\n        db = client.db(MONGODB_DB_NAME);\n        console.log(\"Successfully connected to MongoDB.\");\n        // Initialize collections\n        collections.videoJobsCollection = db.collection(\"videoJobs\");\n        collections.transcriptChunksCollection = db.collection(\"transcriptChunks\");\n        collections.cachedVideoQACollection = db.collection(\"cachedVideoQA\");\n        // Create Indexes (idempotent - only creates if they don't exist)\n        await collections.videoJobsCollection.createIndex({\n            jobId: 1\n        }, {\n            unique: true\n        });\n        await collections.transcriptChunksCollection.createIndex({\n            jobId: 1,\n            chunkId: 1\n        }, {\n            unique: true\n        });\n        await collections.transcriptChunksCollection.createIndex({\n            jobId: 1\n        }); // For fetching all chunks for a job\n        await collections.cachedVideoQACollection.createIndex({\n            jobId: 1,\n            questionTextNormalized: 1,\n            modelUsed: 1,\n            cacheType: 1\n        }, {\n            name: \"user_question_cache_idx\"\n        });\n        await collections.cachedVideoQACollection.createIndex({\n            jobId: 1,\n            analysisType: 1,\n            modelUsed: 1,\n            cacheType: 1\n        }, {\n            name: \"proactive_analysis_cache_idx\"\n        });\n        return db;\n    } catch (error) {\n        console.error(\"Failed to connect to MongoDB:\", error);\n        client = null; // Reset client on failure\n        db = null; // Reset db on failure\n        // Provide more specific error messages\n        if (error instanceof Error) {\n            if (error.message.includes(\"ECONNREFUSED\")) {\n                throw new Error(\"Could not connect to MongoDB server. Please check if the server is running and accessible.\");\n            } else if (error.message.includes(\"Authentication failed\")) {\n                throw new Error(\"MongoDB authentication failed. Please check your credentials.\");\n            } else if (error.message.includes(\"Invalid URI\")) {\n                throw new Error(\"Invalid MongoDB URI. Please check your connection string.\");\n            } else if (error.message.includes(\"TLS\")) {\n                throw new Error(\"TLS connection failed. Please check your SSL/TLS configuration.\");\n            }\n        }\n        throw new Error(`MongoDB connection error: ${error instanceof Error ? error.message : \"Unknown error\"}`);\n    }\n}\n// Export a function to get specific collections, ensuring DB connection\nasync function getCollections() {\n    if (!db || !client) {\n        await connectToDatabase();\n    }\n    if (!collections.videoJobsCollection || !collections.transcriptChunksCollection || !collections.cachedVideoQACollection) {\n        // This might happen if connectToDatabase was called but collections weren't set (shouldn't occur with current logic)\n        // Or if db connection was lost and re-established without re-setting collections object.\n        // For simplicity, re-run connectToDatabase which also sets collections.\n        await connectToDatabase();\n    }\n    return collections;\n}\n// --- Video Job Functions ---\nasync function createVideoJob(jobData) {\n    const { videoJobsCollection } = await getCollections();\n    if (!videoJobsCollection) throw new Error(\"videoJobsCollection not initialized\");\n    const newJob = {\n        ...jobData,\n        status: jobData.status || \"pending\",\n        createdAt: new Date(),\n        updatedAt: new Date()\n    };\n    const result = await videoJobsCollection.insertOne(newJob);\n    if (!result.insertedId) {\n        throw new Error(\"Failed to create video job.\");\n    }\n    return {\n        ...newJob,\n        _id: result.insertedId\n    };\n}\nasync function getVideoJob(jobId) {\n    const { videoJobsCollection } = await getCollections();\n    if (!videoJobsCollection) throw new Error(\"videoJobsCollection not initialized\");\n    return videoJobsCollection.findOne({\n        jobId\n    });\n}\nasync function updateVideoJob(jobId, updates) {\n    const { videoJobsCollection } = await getCollections();\n    if (!videoJobsCollection) throw new Error(\"videoJobsCollection not initialized\");\n    const result = await videoJobsCollection.updateOne({\n        jobId\n    }, {\n        $set: {\n            ...updates,\n            updatedAt: new Date()\n        }\n    });\n    return result.modifiedCount > 0;\n}\n// --- Transcript Chunk Functions ---\nasync function createTranscriptChunks(chunksData) {\n    const { transcriptChunksCollection } = await getCollections();\n    if (!transcriptChunksCollection) throw new Error(\"transcriptChunksCollection not initialized\");\n    if (chunksData.length === 0) return;\n    const chunksToInsert = chunksData.map((chunk)=>({\n            ...chunk,\n            createdAt: new Date()\n        }));\n    try {\n        // First, delete any existing chunks for this job\n        if (chunksToInsert.length > 0) {\n            await transcriptChunksCollection.deleteMany({\n                jobId: chunksToInsert[0].jobId\n            });\n        }\n        // Then insert the new chunks\n        const result = await transcriptChunksCollection.insertMany(chunksToInsert);\n        console.log(`Successfully inserted ${result.insertedCount} transcript chunks`);\n    } catch (error) {\n        console.error(\"Error in createTranscriptChunks:\", error);\n        throw new Error(`Failed to create transcript chunks: ${error instanceof Error ? error.message : \"Unknown error\"}`);\n    }\n}\nasync function getTranscriptChunks(jobId) {\n    const { transcriptChunksCollection } = await getCollections();\n    if (!transcriptChunksCollection) throw new Error(\"transcriptChunksCollection not initialized\");\n    return transcriptChunksCollection.find({\n        jobId\n    }).sort({\n        startTimestamp: 1\n    }).toArray(); // Sort by start time\n}\nasync function updateTranscriptChunkEmbeddings(jobId, chunkId, embedding) {\n    const { transcriptChunksCollection } = await getCollections();\n    if (!transcriptChunksCollection) throw new Error(\"transcriptChunksCollection not initialized\");\n    const result = await transcriptChunksCollection.updateOne({\n        jobId,\n        chunkId\n    }, {\n        $set: {\n            embedding\n        }\n    });\n    return result.modifiedCount > 0;\n}\n// --- Q&A Cache Functions ---\nasync function getCachedQAResponse(jobId, normalizedQuestionText, modelUsed) {\n    const { cachedVideoQACollection } = await getCollections();\n    if (!cachedVideoQACollection) throw new Error(\"cachedVideoQACollection not initialized\");\n    // console.log(`CACHE_LOOKUP: jobId=${jobId}, question='${normalizedQuestionText}', model='${modelUsed}'`); // Debug\n    const response = await cachedVideoQACollection.findOne({\n        jobId,\n        questionTextNormalized: normalizedQuestionText,\n        modelUsed,\n        cacheType: \"user_question\"\n    });\n    // if (response) console.log(\"CACHE_HIT\"); else console.log(\"CACHE_MISS\"); // Debug\n    return response;\n}\nasync function getCachedProactiveAnalysis(jobId, analysisType, modelUsed) {\n    const { cachedVideoQACollection } = await getCollections();\n    if (!cachedVideoQACollection) throw new Error(\"cachedVideoQACollection not initialized\");\n    return cachedVideoQACollection.findOne({\n        jobId,\n        analysisType,\n        modelUsed,\n        cacheType: \"proactive_analysis\"\n    });\n}\nasync function saveQAResponse(jobId, questionOrAnalysisType, modelUsed, responseText, cacheType = \"user_question\" // Default to user_question\n) {\n    const { cachedVideoQACollection } = await getCollections();\n    if (!cachedVideoQACollection) throw new Error(\"cachedVideoQACollection not initialized\");\n    const now = new Date();\n    let filter;\n    let updateData;\n    if (cacheType === \"user_question\") {\n        filter = {\n            jobId,\n            questionTextNormalized: questionOrAnalysisType,\n            modelUsed,\n            cacheType\n        };\n        updateData = {\n            $set: {\n                responseText,\n                updatedAt: now\n            },\n            $setOnInsert: {\n                jobId,\n                questionTextNormalized: questionOrAnalysisType,\n                modelUsed,\n                cacheType,\n                createdAt: now\n            }\n        };\n    } else {\n        filter = {\n            jobId,\n            analysisType: questionOrAnalysisType,\n            modelUsed,\n            cacheType\n        };\n        updateData = {\n            $set: {\n                responseText,\n                updatedAt: now\n            },\n            $setOnInsert: {\n                jobId,\n                analysisType: questionOrAnalysisType,\n                modelUsed,\n                cacheType,\n                createdAt: now\n            }\n        };\n    }\n    try {\n        // console.log(`CACHE_SAVE: jobId=${jobId}, key='${questionOrAnalysisType}', model='${modelUsed}', type='${cacheType}'`); // Debug\n        await cachedVideoQACollection.updateOne(filter, updateData, {\n            upsert: true\n        });\n    // console.log(\"CACHE_SAVE successful\"); // Debug\n    } catch (error) {\n        console.error(\"Error saving Q&A response to cache:\", error);\n    // Decide if this error should be propagated or just logged\n    // For async background saves, logging might be sufficient.\n    }\n}\n// Optional: Function to clear MongoDB client connection (e.g., for graceful shutdown)\nasync function closeDatabaseConnection() {\n    if (client) {\n        await client.close();\n        client = null;\n        db = null;\n        console.log(\"MongoDB connection closed.\");\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL21vbmdvZGIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBa0Y7QUF3Q2xGLE1BQU1FLGNBQWNDLFFBQVFDLEdBQUcsQ0FBQ0YsV0FBVztBQUMzQyxNQUFNRyxrQkFBa0JGLFFBQVFDLEdBQUcsQ0FBQ0MsZUFBZSxJQUFJLGNBQWMsa0JBQWtCO0FBRXZGLElBQUksQ0FBQ0gsYUFBYTtJQUNoQixNQUFNLElBQUlJLE1BQU07QUFDbEI7QUFFQSxJQUFJQyxTQUE2QjtBQUNqQyxJQUFJQyxLQUFnQjtBQVFwQixNQUFNQyxjQUEyQixDQUFDO0FBRTNCLGVBQWVDO0lBQ3BCLElBQUlGLE1BQU1ELFFBQVE7UUFDaEIsOEVBQThFO1FBQzlFLGlHQUFpRztRQUNqRywyRUFBMkU7UUFDM0Usc0RBQXNEO1FBQ3RELE9BQU9DO0lBQ1Q7SUFFQSxJQUFJLENBQUNOLGFBQWE7UUFDaEIsTUFBTSxJQUFJSSxNQUFNO0lBQ2xCO0lBRUFDLFNBQVMsSUFBSVAsZ0RBQVdBLENBQUNFLGFBQWE7UUFDcENTLFdBQVdWLHFEQUFnQkEsQ0FBQ1csRUFBRTtRQUM5QkMsS0FBSztRQUNMQyw2QkFBNkI7UUFDN0JDLDBCQUEwQjtRQUMxQkMsYUFBYTtRQUNiQyxhQUFhO1FBQ2JDLGVBQWU7UUFDZkMsa0JBQWtCO1FBQ2xCQyxpQkFBaUI7UUFDakJDLGFBQWE7UUFDYkMsWUFBWTtRQUNaQyxrQkFBa0I7SUFDcEI7SUFFQSxJQUFJO1FBQ0YsTUFBTWhCLE9BQU9pQixPQUFPO1FBQ3BCaEIsS0FBS0QsT0FBT0MsRUFBRSxDQUFDSDtRQUNmb0IsUUFBUUMsR0FBRyxDQUFDO1FBRVoseUJBQXlCO1FBQ3pCakIsWUFBWWtCLG1CQUFtQixHQUFHbkIsR0FBR29CLFVBQVUsQ0FBVztRQUMxRG5CLFlBQVlvQiwwQkFBMEIsR0FBR3JCLEdBQUdvQixVQUFVLENBQWtCO1FBQ3hFbkIsWUFBWXFCLHVCQUF1QixHQUFHdEIsR0FBR29CLFVBQVUsQ0FBbUI7UUFFdEUsaUVBQWlFO1FBQ2pFLE1BQU1uQixZQUFZa0IsbUJBQW1CLENBQUNJLFdBQVcsQ0FBQztZQUFFQyxPQUFPO1FBQUUsR0FBRztZQUFFQyxRQUFRO1FBQUs7UUFDL0UsTUFBTXhCLFlBQVlvQiwwQkFBMEIsQ0FBQ0UsV0FBVyxDQUFDO1lBQUVDLE9BQU87WUFBR0UsU0FBUztRQUFFLEdBQUc7WUFBRUQsUUFBUTtRQUFLO1FBQ2xHLE1BQU14QixZQUFZb0IsMEJBQTBCLENBQUNFLFdBQVcsQ0FBQztZQUFFQyxPQUFPO1FBQUUsSUFBSSxvQ0FBb0M7UUFDNUcsTUFBTXZCLFlBQVlxQix1QkFBdUIsQ0FBQ0MsV0FBVyxDQUNqRDtZQUFFQyxPQUFPO1lBQUdHLHdCQUF3QjtZQUFHQyxXQUFXO1lBQUdDLFdBQVc7UUFBRSxHQUNsRTtZQUFFQyxNQUFNO1FBQTBCO1FBRXRDLE1BQU03QixZQUFZcUIsdUJBQXVCLENBQUNDLFdBQVcsQ0FDakQ7WUFBRUMsT0FBTztZQUFHTyxjQUFjO1lBQUdILFdBQVc7WUFBR0MsV0FBVztRQUFFLEdBQ3hEO1lBQUVDLE1BQU07UUFBK0I7UUFHM0MsT0FBTzlCO0lBQ1QsRUFBRSxPQUFPZ0MsT0FBTztRQUNkZixRQUFRZSxLQUFLLENBQUMsaUNBQWlDQTtRQUMvQ2pDLFNBQVMsTUFBTSwwQkFBMEI7UUFDekNDLEtBQUssTUFBVSxzQkFBc0I7UUFFckMsdUNBQXVDO1FBQ3ZDLElBQUlnQyxpQkFBaUJsQyxPQUFPO1lBQzFCLElBQUlrQyxNQUFNQyxPQUFPLENBQUNDLFFBQVEsQ0FBQyxpQkFBaUI7Z0JBQzFDLE1BQU0sSUFBSXBDLE1BQU07WUFDbEIsT0FBTyxJQUFJa0MsTUFBTUMsT0FBTyxDQUFDQyxRQUFRLENBQUMsMEJBQTBCO2dCQUMxRCxNQUFNLElBQUlwQyxNQUFNO1lBQ2xCLE9BQU8sSUFBSWtDLE1BQU1DLE9BQU8sQ0FBQ0MsUUFBUSxDQUFDLGdCQUFnQjtnQkFDaEQsTUFBTSxJQUFJcEMsTUFBTTtZQUNsQixPQUFPLElBQUlrQyxNQUFNQyxPQUFPLENBQUNDLFFBQVEsQ0FBQyxRQUFRO2dCQUN4QyxNQUFNLElBQUlwQyxNQUFNO1lBQ2xCO1FBQ0Y7UUFDQSxNQUFNLElBQUlBLE1BQU0sQ0FBQywwQkFBMEIsRUFBRWtDLGlCQUFpQmxDLFFBQVFrQyxNQUFNQyxPQUFPLEdBQUcsZ0JBQWdCLENBQUM7SUFDekc7QUFDRjtBQUVBLHdFQUF3RTtBQUNqRSxlQUFlRTtJQUNwQixJQUFJLENBQUNuQyxNQUFNLENBQUNELFFBQVE7UUFDbEIsTUFBTUc7SUFDUjtJQUNBLElBQUksQ0FBQ0QsWUFBWWtCLG1CQUFtQixJQUFJLENBQUNsQixZQUFZb0IsMEJBQTBCLElBQUksQ0FBQ3BCLFlBQVlxQix1QkFBdUIsRUFBRTtRQUN2SCxxSEFBcUg7UUFDckgseUZBQXlGO1FBQ3pGLHdFQUF3RTtRQUN4RSxNQUFNcEI7SUFDUjtJQUNBLE9BQU9EO0FBQ1Q7QUFFQSw4QkFBOEI7QUFDdkIsZUFBZW1DLGVBQWVDLE9BQTBEO0lBQzdGLE1BQU0sRUFBRWxCLG1CQUFtQixFQUFFLEdBQUcsTUFBTWdCO0lBQ3RDLElBQUksQ0FBQ2hCLHFCQUFxQixNQUFNLElBQUlyQixNQUFNO0lBRTFDLE1BQU13QyxTQUFtQjtRQUN2QixHQUFHRCxPQUFPO1FBQ1ZFLFFBQVFGLFFBQVFFLE1BQU0sSUFBSTtRQUMxQkMsV0FBVyxJQUFJQztRQUNmQyxXQUFXLElBQUlEO0lBQ2pCO0lBQ0EsTUFBTUUsU0FBUyxNQUFNeEIsb0JBQW9CeUIsU0FBUyxDQUFDTjtJQUNuRCxJQUFJLENBQUNLLE9BQU9FLFVBQVUsRUFBRTtRQUN0QixNQUFNLElBQUkvQyxNQUFNO0lBQ2xCO0lBQ0EsT0FBTztRQUFFLEdBQUd3QyxNQUFNO1FBQUVRLEtBQUtILE9BQU9FLFVBQVU7SUFBQztBQUM3QztBQUVPLGVBQWVFLFlBQVl2QixLQUFhO0lBQzdDLE1BQU0sRUFBRUwsbUJBQW1CLEVBQUUsR0FBRyxNQUFNZ0I7SUFDdEMsSUFBSSxDQUFDaEIscUJBQXFCLE1BQU0sSUFBSXJCLE1BQU07SUFDMUMsT0FBT3FCLG9CQUFvQjZCLE9BQU8sQ0FBQztRQUFFeEI7SUFBTTtBQUM3QztBQUVPLGVBQWV5QixlQUFlekIsS0FBYSxFQUFFMEIsT0FBMEI7SUFDNUUsTUFBTSxFQUFFL0IsbUJBQW1CLEVBQUUsR0FBRyxNQUFNZ0I7SUFDdEMsSUFBSSxDQUFDaEIscUJBQXFCLE1BQU0sSUFBSXJCLE1BQU07SUFFMUMsTUFBTTZDLFNBQVMsTUFBTXhCLG9CQUFvQmdDLFNBQVMsQ0FDaEQ7UUFBRTNCO0lBQU0sR0FDUjtRQUFFNEIsTUFBTTtZQUFFLEdBQUdGLE9BQU87WUFBRVIsV0FBVyxJQUFJRDtRQUFPO0lBQUU7SUFFaEQsT0FBT0UsT0FBT1UsYUFBYSxHQUFHO0FBQ2hDO0FBRUEscUNBQXFDO0FBQzlCLGVBQWVDLHVCQUF1QkMsVUFBNkI7SUFDeEUsTUFBTSxFQUFFbEMsMEJBQTBCLEVBQUUsR0FBRyxNQUFNYztJQUM3QyxJQUFJLENBQUNkLDRCQUE0QixNQUFNLElBQUl2QixNQUFNO0lBQ2pELElBQUl5RCxXQUFXQyxNQUFNLEtBQUssR0FBRztJQUU3QixNQUFNQyxpQkFBaUJGLFdBQVdHLEdBQUcsQ0FBQ0MsQ0FBQUEsUUFBVTtZQUM5QyxHQUFHQSxLQUFLO1lBQ1JuQixXQUFXLElBQUlDO1FBQ2pCO0lBRUEsSUFBSTtRQUNGLGlEQUFpRDtRQUNqRCxJQUFJZ0IsZUFBZUQsTUFBTSxHQUFHLEdBQUc7WUFDN0IsTUFBTW5DLDJCQUEyQnVDLFVBQVUsQ0FBQztnQkFBRXBDLE9BQU9pQyxjQUFjLENBQUMsRUFBRSxDQUFDakMsS0FBSztZQUFDO1FBQy9FO1FBRUEsNkJBQTZCO1FBQzdCLE1BQU1tQixTQUFTLE1BQU10QiwyQkFBMkJ3QyxVQUFVLENBQUNKO1FBQzNEeEMsUUFBUUMsR0FBRyxDQUFDLENBQUMsc0JBQXNCLEVBQUV5QixPQUFPbUIsYUFBYSxDQUFDLGtCQUFrQixDQUFDO0lBQy9FLEVBQUUsT0FBTzlCLE9BQU87UUFDZGYsUUFBUWUsS0FBSyxDQUFDLG9DQUFvQ0E7UUFDbEQsTUFBTSxJQUFJbEMsTUFBTSxDQUFDLG9DQUFvQyxFQUFFa0MsaUJBQWlCbEMsUUFBUWtDLE1BQU1DLE9BQU8sR0FBRyxnQkFBZ0IsQ0FBQztJQUNuSDtBQUNGO0FBRU8sZUFBZThCLG9CQUFvQnZDLEtBQWE7SUFDckQsTUFBTSxFQUFFSCwwQkFBMEIsRUFBRSxHQUFHLE1BQU1jO0lBQzdDLElBQUksQ0FBQ2QsNEJBQTRCLE1BQU0sSUFBSXZCLE1BQU07SUFDakQsT0FBT3VCLDJCQUEyQjJDLElBQUksQ0FBQztRQUFFeEM7SUFBTSxHQUFHeUMsSUFBSSxDQUFDO1FBQUVDLGdCQUFnQjtJQUFFLEdBQUdDLE9BQU8sSUFBSSxxQkFBcUI7QUFDaEg7QUFFTyxlQUFlQyxnQ0FBZ0M1QyxLQUFhLEVBQUVFLE9BQWUsRUFBRTJDLFNBQW1CO0lBQ3JHLE1BQU0sRUFBRWhELDBCQUEwQixFQUFFLEdBQUcsTUFBTWM7SUFDN0MsSUFBSSxDQUFDZCw0QkFBNEIsTUFBTSxJQUFJdkIsTUFBTTtJQUVqRCxNQUFNNkMsU0FBUyxNQUFNdEIsMkJBQTJCOEIsU0FBUyxDQUNyRDtRQUFFM0I7UUFBT0U7SUFBUSxHQUNqQjtRQUFFMEIsTUFBTTtZQUFFaUI7UUFBVTtJQUFFO0lBRTFCLE9BQU8xQixPQUFPVSxhQUFhLEdBQUc7QUFDbEM7QUFFQSw4QkFBOEI7QUFDdkIsZUFBZWlCLG9CQUNwQjlDLEtBQWEsRUFDYitDLHNCQUE4QixFQUM5QjNDLFNBQWlCO0lBRWpCLE1BQU0sRUFBRU4sdUJBQXVCLEVBQUUsR0FBRyxNQUFNYTtJQUMxQyxJQUFJLENBQUNiLHlCQUF5QixNQUFNLElBQUl4QixNQUFNO0lBRTlDLG9IQUFvSDtJQUNwSCxNQUFNMEUsV0FBVyxNQUFNbEQsd0JBQXdCMEIsT0FBTyxDQUFDO1FBQ3JEeEI7UUFDQUcsd0JBQXdCNEM7UUFDeEIzQztRQUNBQyxXQUFXO0lBQ2I7SUFDQSxtRkFBbUY7SUFDbkYsT0FBTzJDO0FBQ1Q7QUFFTyxlQUFlQywyQkFDcEJqRCxLQUFhLEVBQ2JPLFlBQW9CLEVBQ3BCSCxTQUFpQjtJQUVqQixNQUFNLEVBQUVOLHVCQUF1QixFQUFFLEdBQUcsTUFBTWE7SUFDMUMsSUFBSSxDQUFDYix5QkFBeUIsTUFBTSxJQUFJeEIsTUFBTTtJQUM5QyxPQUFPd0Isd0JBQXdCMEIsT0FBTyxDQUFDO1FBQ3JDeEI7UUFDQU87UUFDQUg7UUFDQUMsV0FBVztJQUNiO0FBQ0Y7QUFFTyxlQUFlNkMsZUFDcEJsRCxLQUFhLEVBQ2JtRCxzQkFBOEIsRUFDOUIvQyxTQUFpQixFQUNqQmdELFlBQW9CLEVBQ3BCL0MsWUFBb0QsZ0JBQWdCLDJCQUEyQjtBQUE1QjtJQUVuRSxNQUFNLEVBQUVQLHVCQUF1QixFQUFFLEdBQUcsTUFBTWE7SUFDMUMsSUFBSSxDQUFDYix5QkFBeUIsTUFBTSxJQUFJeEIsTUFBTTtJQUU5QyxNQUFNK0UsTUFBTSxJQUFJcEM7SUFDaEIsSUFBSXFDO0lBQ0osSUFBSUM7SUFFSixJQUFJbEQsY0FBYyxpQkFBaUI7UUFDakNpRCxTQUFTO1lBQUV0RDtZQUFPRyx3QkFBd0JnRDtZQUF3Qi9DO1lBQVdDO1FBQVU7UUFDdkZrRCxhQUFhO1lBQ1gzQixNQUFNO2dCQUFFd0I7Z0JBQWNsQyxXQUFXbUM7WUFBSTtZQUNyQ0csY0FBYztnQkFBRXhEO2dCQUFPRyx3QkFBd0JnRDtnQkFBd0IvQztnQkFBV0M7Z0JBQVdXLFdBQVdxQztZQUFJO1FBQzlHO0lBQ0YsT0FBTztRQUNMQyxTQUFTO1lBQUV0RDtZQUFPTyxjQUFjNEM7WUFBd0IvQztZQUFXQztRQUFVO1FBQzdFa0QsYUFBYTtZQUNYM0IsTUFBTTtnQkFBRXdCO2dCQUFjbEMsV0FBV21DO1lBQUk7WUFDckNHLGNBQWM7Z0JBQUV4RDtnQkFBT08sY0FBYzRDO2dCQUF3Qi9DO2dCQUFXQztnQkFBV1csV0FBV3FDO1lBQUk7UUFDcEc7SUFDRjtJQUVBLElBQUk7UUFDRixrSUFBa0k7UUFDbEksTUFBTXZELHdCQUF3QjZCLFNBQVMsQ0FBQzJCLFFBQVFDLFlBQVk7WUFBRUUsUUFBUTtRQUFLO0lBQzNFLGlEQUFpRDtJQUNuRCxFQUFFLE9BQU9qRCxPQUFPO1FBQ2RmLFFBQVFlLEtBQUssQ0FBQyx1Q0FBdUNBO0lBQ3JELDJEQUEyRDtJQUMzRCwyREFBMkQ7SUFDN0Q7QUFDRjtBQUVBLHNGQUFzRjtBQUMvRSxlQUFla0Q7SUFDcEIsSUFBSW5GLFFBQVE7UUFDVixNQUFNQSxPQUFPb0YsS0FBSztRQUNsQnBGLFNBQVM7UUFDVEMsS0FBSztRQUNMaUIsUUFBUUMsR0FBRyxDQUFDO0lBQ2Q7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2NoYXRweWUvLi9zcmMvbGliL21vbmdvZGIudHM/NTNjMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb2xsZWN0aW9uLCBEYiwgTW9uZ29DbGllbnQsIFNlcnZlckFwaVZlcnNpb24sIE9iamVjdElkIH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG4vLyBEZWZpbmUgaW50ZXJmYWNlcyBmb3IgeW91ciBkYXRhIHN0cnVjdHVyZXNcclxuZXhwb3J0IGludGVyZmFjZSBWaWRlb0pvYiB7XHJcbiAgX2lkPzogT2JqZWN0SWQ7XHJcbiAgam9iSWQ6IHN0cmluZztcclxuICB5b3V0dWJlVXJsOiBzdHJpbmc7XHJcbiAgc3RhdHVzOiAncGVuZGluZycgfCAncHJvY2Vzc2luZycgfCAnY29tcGxldGVkJyB8ICdmYWlsZWQnO1xyXG4gIHRyYW5zY3JpcHRTdGF0dXM/OiAncHJvY2Vzc2luZycgfCAnZm91bmQnIHwgJ25vdF9mb3VuZCcgfCAnZmFpbGVkJyB8ICdlcnJvcic7XHJcbiAgcHJvZ3Jlc3M/OiBzdHJpbmc7IC8vIE9wdGlvbmFsIHByb2dyZXNzIG1lc3NhZ2VcclxuICBjcmVhdGVkQXQ/OiBEYXRlO1xyXG4gIHVwZGF0ZWRBdD86IERhdGU7XHJcbiAgLy8gWW91IG1pZ2h0IGFkZCBtb3JlIGZpZWxkcyBsaWtlIHZpZGVvVGl0bGUsIGR1cmF0aW9uLCBldGMuXHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHJhbnNjcmlwdENodW5rIHtcclxuICBfaWQ/OiBPYmplY3RJZDtcclxuICBqb2JJZDogc3RyaW5nO1xyXG4gIGNodW5rSWQ6IHN0cmluZzsgLy8gZS5nLiwgam9iSWQtY2h1bmtJbmRleFxyXG4gIHRleHRDb250ZW50OiBzdHJpbmc7XHJcbiAgc3RhcnRUaW1lc3RhbXA6IHN0cmluZzsgLy8gU3RvcmUgYXMgc3RyaW5nLCBjb25zaXN0ZW50IHdpdGggY3VycmVudCBSQUcgdXNlXHJcbiAgZW5kVGltZXN0YW1wOiBzdHJpbmc7ICAgLy8gU3RvcmUgYXMgc3RyaW5nXHJcbiAgZW1iZWRkaW5nPzogbnVtYmVyW107IC8vIEFycmF5IG9mIG51bWJlcnMgZm9yIHRoZSBlbWJlZGRpbmdcclxuICBjcmVhdGVkQXQ/OiBEYXRlO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIENhY2hlZFFBUmVzcG9uc2Uge1xyXG4gIF9pZD86IE9iamVjdElkO1xyXG4gIGpvYklkOiBzdHJpbmc7IC8vIFJlZmVyZW5jZXMgdGhlIFZpZGVvSm9iLmpvYklkIChpZGVudGlmaWVzIHRoZSB2aWRlbylcclxuICBjYWNoZVR5cGU6ICd1c2VyX3F1ZXN0aW9uJyB8ICdwcm9hY3RpdmVfYW5hbHlzaXMnO1xyXG4gIHF1ZXN0aW9uVGV4dE5vcm1hbGl6ZWQ/OiBzdHJpbmc7IC8vIEZvciB1c2VyX3F1ZXN0aW9uIHR5cGVcclxuICBhbmFseXNpc1R5cGU/OiBzdHJpbmc7IC8vIEZvciBwcm9hY3RpdmVfYW5hbHlzaXMgdHlwZSAoZS5nLiwgXCJwcm9hY3RpdmVfc3VtbWFyeV90b3BpY3NfdGFrZWF3YXlzXCIpXHJcbiAgcmVzcG9uc2VUZXh0OiBzdHJpbmc7XHJcbiAgbW9kZWxVc2VkOiBzdHJpbmc7IC8vIGUuZy4sIFwiZ2VtaW5pLTEuNS1wcm8tZGlyZWN0LXlvdXR1YmVcIlxyXG4gIGNyZWF0ZWRBdDogRGF0ZTtcclxuICB1cGRhdGVkQXQ6IERhdGU7IC8vIFRvIGtub3cgd2hlbiBpdCB3YXMgbGFzdCB1cGRhdGVkIChmb3IgdXBzZXJ0KVxyXG4gIC8vIHNvdXJjZUxhbmd1YWdlPzogc3RyaW5nOyAvLyBGdXR1cmUgdXNlXHJcbiAgLy8gc3RydWN0dXJlZFJlc3BvbnNlRGF0YT86IGFueTsgLy8gRnV0dXJlIHVzZSBmb3Igc3RydWN0dXJlZCBwcm9hY3RpdmUgYW5hbHlzaXNcclxufVxyXG5cclxuY29uc3QgTU9OR09EQl9VUkkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcclxuY29uc3QgTU9OR09EQl9EQl9OQU1FID0gcHJvY2Vzcy5lbnYuTU9OR09EQl9EQl9OQU1FIHx8ICdjaGF0cHllX2RiJzsgLy8gRGVmYXVsdCBEQiBuYW1lXHJcblxyXG5pZiAoIU1PTkdPREJfVVJJKSB7XHJcbiAgdGhyb3cgbmV3IEVycm9yKCdQbGVhc2UgZGVmaW5lIHRoZSBNT05HT0RCX1VSSSBlbnZpcm9ubWVudCB2YXJpYWJsZSBpbiAuZW52LmxvY2FsJyk7XHJcbn1cclxuXHJcbmxldCBjbGllbnQ6IE1vbmdvQ2xpZW50IHwgbnVsbCA9IG51bGw7XHJcbmxldCBkYjogRGIgfCBudWxsID0gbnVsbDtcclxuXHJcbmludGVyZmFjZSBDb2xsZWN0aW9ucyB7XHJcbiAgdmlkZW9Kb2JzQ29sbGVjdGlvbj86IENvbGxlY3Rpb248VmlkZW9Kb2I+O1xyXG4gIHRyYW5zY3JpcHRDaHVua3NDb2xsZWN0aW9uPzogQ29sbGVjdGlvbjxUcmFuc2NyaXB0Q2h1bms+O1xyXG4gIGNhY2hlZFZpZGVvUUFDb2xsZWN0aW9uPzogQ29sbGVjdGlvbjxDYWNoZWRRQVJlc3BvbnNlPjtcclxufVxyXG5cclxuY29uc3QgY29sbGVjdGlvbnM6IENvbGxlY3Rpb25zID0ge307XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29ubmVjdFRvRGF0YWJhc2UoKTogUHJvbWlzZTxEYj4ge1xyXG4gIGlmIChkYiAmJiBjbGllbnQpIHtcclxuICAgIC8vIFRPRE86IFZlcmlmeSBjbGllbnQgY29ubmVjdGlvbiBzdGF0ZSBpZiBwb3NzaWJsZSwgZS5nLiBjbGllbnQuaXNDb25uZWN0ZWQoKVxyXG4gICAgLy8gRm9yIHNlcnZlcmxlc3MsIGNyZWF0aW5nIG5ldyBjb25uZWN0aW9ucyBwZXIgcmVxdWVzdCBvciBzaG9ydC1saXZlZCBjb25uZWN0aW9ucyBtaWdodCBiZSBva2F5LlxyXG4gICAgLy8gRm9yIGxvbmctcnVubmluZyBzZXJ2ZXJzLCBtYWludGFpbmluZyBhIHBlcnNpc3RlbnQgY29ubmVjdGlvbiBpcyBiZXR0ZXIuXHJcbiAgICAvLyBUaGlzIHNpbXBsZSBjaGVjayBhc3N1bWVzIGNsaWVudCByZW1haW5zIGNvbm5lY3RlZC5cclxuICAgIHJldHVybiBkYjtcclxuICB9XHJcblxyXG4gIGlmICghTU9OR09EQl9VUkkpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignTW9uZ29EQiBVUkkgaXMgbm90IGRlZmluZWQuJyk7XHJcbiAgfVxyXG5cclxuICBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQoTU9OR09EQl9VUkksIHtcclxuICAgIHNlcnZlckFwaTogU2VydmVyQXBpVmVyc2lvbi52MSxcclxuICAgIHRsczogdHJ1ZSxcclxuICAgIHRsc0FsbG93SW52YWxpZENlcnRpZmljYXRlczogdHJ1ZSwgLy8gQWxsb3cgaW52YWxpZCBjZXJ0aWZpY2F0ZXMgaW4gZGV2ZWxvcG1lbnRcclxuICAgIHRsc0FsbG93SW52YWxpZEhvc3RuYW1lczogdHJ1ZSwgICAgLy8gQWxsb3cgaW52YWxpZCBob3N0bmFtZXMgaW4gZGV2ZWxvcG1lbnRcclxuICAgIG1heFBvb2xTaXplOiA1MCxcclxuICAgIG1pblBvb2xTaXplOiAxMCxcclxuICAgIG1heElkbGVUaW1lTVM6IDYwMDAwLFxyXG4gICAgY29ubmVjdFRpbWVvdXRNUzogMzAwMDAsXHJcbiAgICBzb2NrZXRUaW1lb3V0TVM6IDQ1MDAwLFxyXG4gICAgcmV0cnlXcml0ZXM6IHRydWUsXHJcbiAgICByZXRyeVJlYWRzOiB0cnVlLFxyXG4gICAgZGlyZWN0Q29ubmVjdGlvbjogZmFsc2VcclxuICB9KTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IGNsaWVudC5jb25uZWN0KCk7XHJcbiAgICBkYiA9IGNsaWVudC5kYihNT05HT0RCX0RCX05BTUUpO1xyXG4gICAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSBjb25uZWN0ZWQgdG8gTW9uZ29EQi4nKTtcclxuXHJcbiAgICAvLyBJbml0aWFsaXplIGNvbGxlY3Rpb25zXHJcbiAgICBjb2xsZWN0aW9ucy52aWRlb0pvYnNDb2xsZWN0aW9uID0gZGIuY29sbGVjdGlvbjxWaWRlb0pvYj4oJ3ZpZGVvSm9icycpO1xyXG4gICAgY29sbGVjdGlvbnMudHJhbnNjcmlwdENodW5rc0NvbGxlY3Rpb24gPSBkYi5jb2xsZWN0aW9uPFRyYW5zY3JpcHRDaHVuaz4oJ3RyYW5zY3JpcHRDaHVua3MnKTtcclxuICAgIGNvbGxlY3Rpb25zLmNhY2hlZFZpZGVvUUFDb2xsZWN0aW9uID0gZGIuY29sbGVjdGlvbjxDYWNoZWRRQVJlc3BvbnNlPignY2FjaGVkVmlkZW9RQScpO1xyXG4gICAgXHJcbiAgICAvLyBDcmVhdGUgSW5kZXhlcyAoaWRlbXBvdGVudCAtIG9ubHkgY3JlYXRlcyBpZiB0aGV5IGRvbid0IGV4aXN0KVxyXG4gICAgYXdhaXQgY29sbGVjdGlvbnMudmlkZW9Kb2JzQ29sbGVjdGlvbi5jcmVhdGVJbmRleCh7IGpvYklkOiAxIH0sIHsgdW5pcXVlOiB0cnVlIH0pO1xyXG4gICAgYXdhaXQgY29sbGVjdGlvbnMudHJhbnNjcmlwdENodW5rc0NvbGxlY3Rpb24uY3JlYXRlSW5kZXgoeyBqb2JJZDogMSwgY2h1bmtJZDogMSB9LCB7IHVuaXF1ZTogdHJ1ZSB9KTtcclxuICAgIGF3YWl0IGNvbGxlY3Rpb25zLnRyYW5zY3JpcHRDaHVua3NDb2xsZWN0aW9uLmNyZWF0ZUluZGV4KHsgam9iSWQ6IDEgfSk7IC8vIEZvciBmZXRjaGluZyBhbGwgY2h1bmtzIGZvciBhIGpvYlxyXG4gICAgYXdhaXQgY29sbGVjdGlvbnMuY2FjaGVkVmlkZW9RQUNvbGxlY3Rpb24uY3JlYXRlSW5kZXgoXHJcbiAgICAgICAgeyBqb2JJZDogMSwgcXVlc3Rpb25UZXh0Tm9ybWFsaXplZDogMSwgbW9kZWxVc2VkOiAxLCBjYWNoZVR5cGU6IDEgfSxcclxuICAgICAgICB7IG5hbWU6IFwidXNlcl9xdWVzdGlvbl9jYWNoZV9pZHhcIiB9XHJcbiAgICApO1xyXG4gICAgYXdhaXQgY29sbGVjdGlvbnMuY2FjaGVkVmlkZW9RQUNvbGxlY3Rpb24uY3JlYXRlSW5kZXgoXHJcbiAgICAgICAgeyBqb2JJZDogMSwgYW5hbHlzaXNUeXBlOiAxLCBtb2RlbFVzZWQ6IDEsIGNhY2hlVHlwZTogMSB9LFxyXG4gICAgICAgIHsgbmFtZTogXCJwcm9hY3RpdmVfYW5hbHlzaXNfY2FjaGVfaWR4XCIgfVxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gZGI7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjb25uZWN0IHRvIE1vbmdvREI6JywgZXJyb3IpO1xyXG4gICAgY2xpZW50ID0gbnVsbDsgLy8gUmVzZXQgY2xpZW50IG9uIGZhaWx1cmVcclxuICAgIGRiID0gbnVsbDsgICAgIC8vIFJlc2V0IGRiIG9uIGZhaWx1cmVcclxuICAgIFxyXG4gICAgLy8gUHJvdmlkZSBtb3JlIHNwZWNpZmljIGVycm9yIG1lc3NhZ2VzXHJcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICBpZiAoZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnRUNPTk5SRUZVU0VEJykpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBjb25uZWN0IHRvIE1vbmdvREIgc2VydmVyLiBQbGVhc2UgY2hlY2sgaWYgdGhlIHNlcnZlciBpcyBydW5uaW5nIGFuZCBhY2Nlc3NpYmxlLicpO1xyXG4gICAgICB9IGVsc2UgaWYgKGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ0F1dGhlbnRpY2F0aW9uIGZhaWxlZCcpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNb25nb0RCIGF1dGhlbnRpY2F0aW9uIGZhaWxlZC4gUGxlYXNlIGNoZWNrIHlvdXIgY3JlZGVudGlhbHMuJyk7XHJcbiAgICAgIH0gZWxzZSBpZiAoZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnSW52YWxpZCBVUkknKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBNb25nb0RCIFVSSS4gUGxlYXNlIGNoZWNrIHlvdXIgY29ubmVjdGlvbiBzdHJpbmcuJyk7XHJcbiAgICAgIH0gZWxzZSBpZiAoZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnVExTJykpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RMUyBjb25uZWN0aW9uIGZhaWxlZC4gUGxlYXNlIGNoZWNrIHlvdXIgU1NML1RMUyBjb25maWd1cmF0aW9uLicpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYE1vbmdvREIgY29ubmVjdGlvbiBlcnJvcjogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIEV4cG9ydCBhIGZ1bmN0aW9uIHRvIGdldCBzcGVjaWZpYyBjb2xsZWN0aW9ucywgZW5zdXJpbmcgREIgY29ubmVjdGlvblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29sbGVjdGlvbnMoKTogUHJvbWlzZTxDb2xsZWN0aW9ucz4ge1xyXG4gIGlmICghZGIgfHwgIWNsaWVudCkgeyAvLyBPciBhZGQgbW9yZSByb2J1c3QgY29ubmVjdGlvbiBjaGVja1xyXG4gICAgYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICB9XHJcbiAgaWYgKCFjb2xsZWN0aW9ucy52aWRlb0pvYnNDb2xsZWN0aW9uIHx8ICFjb2xsZWN0aW9ucy50cmFuc2NyaXB0Q2h1bmtzQ29sbGVjdGlvbiB8fCAhY29sbGVjdGlvbnMuY2FjaGVkVmlkZW9RQUNvbGxlY3Rpb24pIHtcclxuICAgIC8vIFRoaXMgbWlnaHQgaGFwcGVuIGlmIGNvbm5lY3RUb0RhdGFiYXNlIHdhcyBjYWxsZWQgYnV0IGNvbGxlY3Rpb25zIHdlcmVuJ3Qgc2V0IChzaG91bGRuJ3Qgb2NjdXIgd2l0aCBjdXJyZW50IGxvZ2ljKVxyXG4gICAgLy8gT3IgaWYgZGIgY29ubmVjdGlvbiB3YXMgbG9zdCBhbmQgcmUtZXN0YWJsaXNoZWQgd2l0aG91dCByZS1zZXR0aW5nIGNvbGxlY3Rpb25zIG9iamVjdC5cclxuICAgIC8vIEZvciBzaW1wbGljaXR5LCByZS1ydW4gY29ubmVjdFRvRGF0YWJhc2Ugd2hpY2ggYWxzbyBzZXRzIGNvbGxlY3Rpb25zLlxyXG4gICAgYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICB9XHJcbiAgcmV0dXJuIGNvbGxlY3Rpb25zO1xyXG59XHJcblxyXG4vLyAtLS0gVmlkZW8gSm9iIEZ1bmN0aW9ucyAtLS1cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVZpZGVvSm9iKGpvYkRhdGE6IE9taXQ8VmlkZW9Kb2IsICdfaWQnIHwgJ2NyZWF0ZWRBdCcgfCAndXBkYXRlZEF0Jz4pOiBQcm9taXNlPFZpZGVvSm9iPiB7XHJcbiAgY29uc3QgeyB2aWRlb0pvYnNDb2xsZWN0aW9uIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gIGlmICghdmlkZW9Kb2JzQ29sbGVjdGlvbikgdGhyb3cgbmV3IEVycm9yKFwidmlkZW9Kb2JzQ29sbGVjdGlvbiBub3QgaW5pdGlhbGl6ZWRcIik7XHJcblxyXG4gIGNvbnN0IG5ld0pvYjogVmlkZW9Kb2IgPSB7XHJcbiAgICAuLi5qb2JEYXRhLFxyXG4gICAgc3RhdHVzOiBqb2JEYXRhLnN0YXR1cyB8fCAncGVuZGluZycsXHJcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgfTtcclxuICBjb25zdCByZXN1bHQgPSBhd2FpdCB2aWRlb0pvYnNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdKb2IpO1xyXG4gIGlmICghcmVzdWx0Lmluc2VydGVkSWQpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSB2aWRlbyBqb2IuJyk7XHJcbiAgfVxyXG4gIHJldHVybiB7IC4uLm5ld0pvYiwgX2lkOiByZXN1bHQuaW5zZXJ0ZWRJZCB9O1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VmlkZW9Kb2Ioam9iSWQ6IHN0cmluZyk6IFByb21pc2U8VmlkZW9Kb2IgfCBudWxsPiB7XHJcbiAgY29uc3QgeyB2aWRlb0pvYnNDb2xsZWN0aW9uIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gIGlmICghdmlkZW9Kb2JzQ29sbGVjdGlvbikgdGhyb3cgbmV3IEVycm9yKFwidmlkZW9Kb2JzQ29sbGVjdGlvbiBub3QgaW5pdGlhbGl6ZWRcIik7XHJcbiAgcmV0dXJuIHZpZGVvSm9ic0NvbGxlY3Rpb24uZmluZE9uZSh7IGpvYklkIH0pO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlVmlkZW9Kb2Ioam9iSWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxWaWRlb0pvYj4pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICBjb25zdCB7IHZpZGVvSm9ic0NvbGxlY3Rpb24gfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XHJcbiAgaWYgKCF2aWRlb0pvYnNDb2xsZWN0aW9uKSB0aHJvdyBuZXcgRXJyb3IoXCJ2aWRlb0pvYnNDb2xsZWN0aW9uIG5vdCBpbml0aWFsaXplZFwiKTtcclxuXHJcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmlkZW9Kb2JzQ29sbGVjdGlvbi51cGRhdGVPbmUoXHJcbiAgICB7IGpvYklkIH0sXHJcbiAgICB7ICRzZXQ6IHsgLi4udXBkYXRlcywgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0gfVxyXG4gICk7XHJcbiAgcmV0dXJuIHJlc3VsdC5tb2RpZmllZENvdW50ID4gMDtcclxufVxyXG5cclxuLy8gLS0tIFRyYW5zY3JpcHQgQ2h1bmsgRnVuY3Rpb25zIC0tLVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlVHJhbnNjcmlwdENodW5rcyhjaHVua3NEYXRhOiBUcmFuc2NyaXB0Q2h1bmtbXSk6IFByb21pc2U8dm9pZD4ge1xyXG4gIGNvbnN0IHsgdHJhbnNjcmlwdENodW5rc0NvbGxlY3Rpb24gfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XHJcbiAgaWYgKCF0cmFuc2NyaXB0Q2h1bmtzQ29sbGVjdGlvbikgdGhyb3cgbmV3IEVycm9yKFwidHJhbnNjcmlwdENodW5rc0NvbGxlY3Rpb24gbm90IGluaXRpYWxpemVkXCIpO1xyXG4gIGlmIChjaHVua3NEYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG5cclxuICBjb25zdCBjaHVua3NUb0luc2VydCA9IGNodW5rc0RhdGEubWFwKGNodW5rID0+ICh7XHJcbiAgICAuLi5jaHVuayxcclxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKVxyXG4gIH0pKTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIEZpcnN0LCBkZWxldGUgYW55IGV4aXN0aW5nIGNodW5rcyBmb3IgdGhpcyBqb2JcclxuICAgIGlmIChjaHVua3NUb0luc2VydC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGF3YWl0IHRyYW5zY3JpcHRDaHVua3NDb2xsZWN0aW9uLmRlbGV0ZU1hbnkoeyBqb2JJZDogY2h1bmtzVG9JbnNlcnRbMF0uam9iSWQgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVGhlbiBpbnNlcnQgdGhlIG5ldyBjaHVua3NcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRyYW5zY3JpcHRDaHVua3NDb2xsZWN0aW9uLmluc2VydE1hbnkoY2h1bmtzVG9JbnNlcnQpO1xyXG4gICAgY29uc29sZS5sb2coYFN1Y2Nlc3NmdWxseSBpbnNlcnRlZCAke3Jlc3VsdC5pbnNlcnRlZENvdW50fSB0cmFuc2NyaXB0IGNodW5rc2ApO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBjcmVhdGVUcmFuc2NyaXB0Q2h1bmtzOicsIGVycm9yKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSB0cmFuc2NyaXB0IGNodW5rczogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRUcmFuc2NyaXB0Q2h1bmtzKGpvYklkOiBzdHJpbmcpOiBQcm9taXNlPFRyYW5zY3JpcHRDaHVua1tdPiB7XHJcbiAgY29uc3QgeyB0cmFuc2NyaXB0Q2h1bmtzQ29sbGVjdGlvbiB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcclxuICBpZiAoIXRyYW5zY3JpcHRDaHVua3NDb2xsZWN0aW9uKSB0aHJvdyBuZXcgRXJyb3IoXCJ0cmFuc2NyaXB0Q2h1bmtzQ29sbGVjdGlvbiBub3QgaW5pdGlhbGl6ZWRcIik7XHJcbiAgcmV0dXJuIHRyYW5zY3JpcHRDaHVua3NDb2xsZWN0aW9uLmZpbmQoeyBqb2JJZCB9KS5zb3J0KHsgc3RhcnRUaW1lc3RhbXA6IDEgfSkudG9BcnJheSgpOyAvLyBTb3J0IGJ5IHN0YXJ0IHRpbWVcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVRyYW5zY3JpcHRDaHVua0VtYmVkZGluZ3Moam9iSWQ6IHN0cmluZywgY2h1bmtJZDogc3RyaW5nLCBlbWJlZGRpbmc6IG51bWJlcltdKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICBjb25zdCB7IHRyYW5zY3JpcHRDaHVua3NDb2xsZWN0aW9uIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9ucygpO1xyXG4gICAgaWYgKCF0cmFuc2NyaXB0Q2h1bmtzQ29sbGVjdGlvbikgdGhyb3cgbmV3IEVycm9yKFwidHJhbnNjcmlwdENodW5rc0NvbGxlY3Rpb24gbm90IGluaXRpYWxpemVkXCIpO1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRyYW5zY3JpcHRDaHVua3NDb2xsZWN0aW9uLnVwZGF0ZU9uZShcclxuICAgICAgICB7IGpvYklkLCBjaHVua0lkIH0sXHJcbiAgICAgICAgeyAkc2V0OiB7IGVtYmVkZGluZyB9IH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gcmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwO1xyXG59XHJcblxyXG4vLyAtLS0gUSZBIENhY2hlIEZ1bmN0aW9ucyAtLS1cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENhY2hlZFFBUmVzcG9uc2UoXHJcbiAgam9iSWQ6IHN0cmluZywgXHJcbiAgbm9ybWFsaXplZFF1ZXN0aW9uVGV4dDogc3RyaW5nLCBcclxuICBtb2RlbFVzZWQ6IHN0cmluZ1xyXG4pOiBQcm9taXNlPENhY2hlZFFBUmVzcG9uc2UgfCBudWxsPiB7XHJcbiAgY29uc3QgeyBjYWNoZWRWaWRlb1FBQ29sbGVjdGlvbiB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcclxuICBpZiAoIWNhY2hlZFZpZGVvUUFDb2xsZWN0aW9uKSB0aHJvdyBuZXcgRXJyb3IoXCJjYWNoZWRWaWRlb1FBQ29sbGVjdGlvbiBub3QgaW5pdGlhbGl6ZWRcIik7XHJcbiAgXHJcbiAgLy8gY29uc29sZS5sb2coYENBQ0hFX0xPT0tVUDogam9iSWQ9JHtqb2JJZH0sIHF1ZXN0aW9uPScke25vcm1hbGl6ZWRRdWVzdGlvblRleHR9JywgbW9kZWw9JyR7bW9kZWxVc2VkfSdgKTsgLy8gRGVidWdcclxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNhY2hlZFZpZGVvUUFDb2xsZWN0aW9uLmZpbmRPbmUoe1xyXG4gICAgam9iSWQsXHJcbiAgICBxdWVzdGlvblRleHROb3JtYWxpemVkOiBub3JtYWxpemVkUXVlc3Rpb25UZXh0LCAvLyBFbnN1cmUgdGhpcyBtYXRjaGVzIHRoZSBmaWVsZCBuYW1lIHVzZWQgaW4gc2F2ZVFBUmVzcG9uc2VcclxuICAgIG1vZGVsVXNlZCxcclxuICAgIGNhY2hlVHlwZTogJ3VzZXJfcXVlc3Rpb24nXHJcbiAgfSk7XHJcbiAgLy8gaWYgKHJlc3BvbnNlKSBjb25zb2xlLmxvZyhcIkNBQ0hFX0hJVFwiKTsgZWxzZSBjb25zb2xlLmxvZyhcIkNBQ0hFX01JU1NcIik7IC8vIERlYnVnXHJcbiAgcmV0dXJuIHJlc3BvbnNlO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q2FjaGVkUHJvYWN0aXZlQW5hbHlzaXMoXHJcbiAgam9iSWQ6IHN0cmluZyxcclxuICBhbmFseXNpc1R5cGU6IHN0cmluZyxcclxuICBtb2RlbFVzZWQ6IHN0cmluZ1xyXG4pOiBQcm9taXNlPENhY2hlZFFBUmVzcG9uc2UgfCBudWxsPiB7XHJcbiAgY29uc3QgeyBjYWNoZWRWaWRlb1FBQ29sbGVjdGlvbiB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnMoKTtcclxuICBpZiAoIWNhY2hlZFZpZGVvUUFDb2xsZWN0aW9uKSB0aHJvdyBuZXcgRXJyb3IoXCJjYWNoZWRWaWRlb1FBQ29sbGVjdGlvbiBub3QgaW5pdGlhbGl6ZWRcIik7XHJcbiAgcmV0dXJuIGNhY2hlZFZpZGVvUUFDb2xsZWN0aW9uLmZpbmRPbmUoe1xyXG4gICAgam9iSWQsXHJcbiAgICBhbmFseXNpc1R5cGUsXHJcbiAgICBtb2RlbFVzZWQsXHJcbiAgICBjYWNoZVR5cGU6ICdwcm9hY3RpdmVfYW5hbHlzaXMnXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzYXZlUUFSZXNwb25zZShcclxuICBqb2JJZDogc3RyaW5nLCBcclxuICBxdWVzdGlvbk9yQW5hbHlzaXNUeXBlOiBzdHJpbmcsIC8vIEZvciB1c2VyX3F1ZXN0aW9uLCB0aGlzIGlzIG5vcm1hbGl6ZWRRdWVzdGlvblRleHQ7IGZvciBwcm9hY3RpdmUsIGl0J3MgYW5hbHlzaXNUeXBlXHJcbiAgbW9kZWxVc2VkOiBzdHJpbmcsIFxyXG4gIHJlc3BvbnNlVGV4dDogc3RyaW5nLFxyXG4gIGNhY2hlVHlwZTogJ3VzZXJfcXVlc3Rpb24nIHwgJ3Byb2FjdGl2ZV9hbmFseXNpcycgPSAndXNlcl9xdWVzdGlvbicgLy8gRGVmYXVsdCB0byB1c2VyX3F1ZXN0aW9uXHJcbik6IFByb21pc2U8dm9pZD4ge1xyXG4gIGNvbnN0IHsgY2FjaGVkVmlkZW9RQUNvbGxlY3Rpb24gfSA9IGF3YWl0IGdldENvbGxlY3Rpb25zKCk7XHJcbiAgaWYgKCFjYWNoZWRWaWRlb1FBQ29sbGVjdGlvbikgdGhyb3cgbmV3IEVycm9yKFwiY2FjaGVkVmlkZW9RQUNvbGxlY3Rpb24gbm90IGluaXRpYWxpemVkXCIpO1xyXG5cclxuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gIGxldCBmaWx0ZXI6IGFueTtcclxuICBsZXQgdXBkYXRlRGF0YTogYW55O1xyXG5cclxuICBpZiAoY2FjaGVUeXBlID09PSAndXNlcl9xdWVzdGlvbicpIHtcclxuICAgIGZpbHRlciA9IHsgam9iSWQsIHF1ZXN0aW9uVGV4dE5vcm1hbGl6ZWQ6IHF1ZXN0aW9uT3JBbmFseXNpc1R5cGUsIG1vZGVsVXNlZCwgY2FjaGVUeXBlIH07XHJcbiAgICB1cGRhdGVEYXRhID0ge1xyXG4gICAgICAkc2V0OiB7IHJlc3BvbnNlVGV4dCwgdXBkYXRlZEF0OiBub3cgfSxcclxuICAgICAgJHNldE9uSW5zZXJ0OiB7IGpvYklkLCBxdWVzdGlvblRleHROb3JtYWxpemVkOiBxdWVzdGlvbk9yQW5hbHlzaXNUeXBlLCBtb2RlbFVzZWQsIGNhY2hlVHlwZSwgY3JlYXRlZEF0OiBub3cgfVxyXG4gICAgfTtcclxuICB9IGVsc2UgeyAvLyBwcm9hY3RpdmVfYW5hbHlzaXNcclxuICAgIGZpbHRlciA9IHsgam9iSWQsIGFuYWx5c2lzVHlwZTogcXVlc3Rpb25PckFuYWx5c2lzVHlwZSwgbW9kZWxVc2VkLCBjYWNoZVR5cGUgfTtcclxuICAgIHVwZGF0ZURhdGEgPSB7XHJcbiAgICAgICRzZXQ6IHsgcmVzcG9uc2VUZXh0LCB1cGRhdGVkQXQ6IG5vdyB9LFxyXG4gICAgICAkc2V0T25JbnNlcnQ6IHsgam9iSWQsIGFuYWx5c2lzVHlwZTogcXVlc3Rpb25PckFuYWx5c2lzVHlwZSwgbW9kZWxVc2VkLCBjYWNoZVR5cGUsIGNyZWF0ZWRBdDogbm93IH1cclxuICAgIH07XHJcbiAgfVxyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICAvLyBjb25zb2xlLmxvZyhgQ0FDSEVfU0FWRTogam9iSWQ9JHtqb2JJZH0sIGtleT0nJHtxdWVzdGlvbk9yQW5hbHlzaXNUeXBlfScsIG1vZGVsPScke21vZGVsVXNlZH0nLCB0eXBlPScke2NhY2hlVHlwZX0nYCk7IC8vIERlYnVnXHJcbiAgICBhd2FpdCBjYWNoZWRWaWRlb1FBQ29sbGVjdGlvbi51cGRhdGVPbmUoZmlsdGVyLCB1cGRhdGVEYXRhLCB7IHVwc2VydDogdHJ1ZSB9KTtcclxuICAgIC8vIGNvbnNvbGUubG9nKFwiQ0FDSEVfU0FWRSBzdWNjZXNzZnVsXCIpOyAvLyBEZWJ1Z1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2F2aW5nIFEmQSByZXNwb25zZSB0byBjYWNoZTpcIiwgZXJyb3IpO1xyXG4gICAgLy8gRGVjaWRlIGlmIHRoaXMgZXJyb3Igc2hvdWxkIGJlIHByb3BhZ2F0ZWQgb3IganVzdCBsb2dnZWRcclxuICAgIC8vIEZvciBhc3luYyBiYWNrZ3JvdW5kIHNhdmVzLCBsb2dnaW5nIG1pZ2h0IGJlIHN1ZmZpY2llbnQuXHJcbiAgfVxyXG59XHJcblxyXG4vLyBPcHRpb25hbDogRnVuY3Rpb24gdG8gY2xlYXIgTW9uZ29EQiBjbGllbnQgY29ubmVjdGlvbiAoZS5nLiwgZm9yIGdyYWNlZnVsIHNodXRkb3duKVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xvc2VEYXRhYmFzZUNvbm5lY3Rpb24oKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgaWYgKGNsaWVudCkge1xyXG4gICAgYXdhaXQgY2xpZW50LmNsb3NlKCk7XHJcbiAgICBjbGllbnQgPSBudWxsO1xyXG4gICAgZGIgPSBudWxsO1xyXG4gICAgY29uc29sZS5sb2coJ01vbmdvREIgY29ubmVjdGlvbiBjbG9zZWQuJyk7XHJcbiAgfVxyXG59ICJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsIlNlcnZlckFwaVZlcnNpb24iLCJNT05HT0RCX1VSSSIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX0RCX05BTUUiLCJFcnJvciIsImNsaWVudCIsImRiIiwiY29sbGVjdGlvbnMiLCJjb25uZWN0VG9EYXRhYmFzZSIsInNlcnZlckFwaSIsInYxIiwidGxzIiwidGxzQWxsb3dJbnZhbGlkQ2VydGlmaWNhdGVzIiwidGxzQWxsb3dJbnZhbGlkSG9zdG5hbWVzIiwibWF4UG9vbFNpemUiLCJtaW5Qb29sU2l6ZSIsIm1heElkbGVUaW1lTVMiLCJjb25uZWN0VGltZW91dE1TIiwic29ja2V0VGltZW91dE1TIiwicmV0cnlXcml0ZXMiLCJyZXRyeVJlYWRzIiwiZGlyZWN0Q29ubmVjdGlvbiIsImNvbm5lY3QiLCJjb25zb2xlIiwibG9nIiwidmlkZW9Kb2JzQ29sbGVjdGlvbiIsImNvbGxlY3Rpb24iLCJ0cmFuc2NyaXB0Q2h1bmtzQ29sbGVjdGlvbiIsImNhY2hlZFZpZGVvUUFDb2xsZWN0aW9uIiwiY3JlYXRlSW5kZXgiLCJqb2JJZCIsInVuaXF1ZSIsImNodW5rSWQiLCJxdWVzdGlvblRleHROb3JtYWxpemVkIiwibW9kZWxVc2VkIiwiY2FjaGVUeXBlIiwibmFtZSIsImFuYWx5c2lzVHlwZSIsImVycm9yIiwibWVzc2FnZSIsImluY2x1ZGVzIiwiZ2V0Q29sbGVjdGlvbnMiLCJjcmVhdGVWaWRlb0pvYiIsImpvYkRhdGEiLCJuZXdKb2IiLCJzdGF0dXMiLCJjcmVhdGVkQXQiLCJEYXRlIiwidXBkYXRlZEF0IiwicmVzdWx0IiwiaW5zZXJ0T25lIiwiaW5zZXJ0ZWRJZCIsIl9pZCIsImdldFZpZGVvSm9iIiwiZmluZE9uZSIsInVwZGF0ZVZpZGVvSm9iIiwidXBkYXRlcyIsInVwZGF0ZU9uZSIsIiRzZXQiLCJtb2RpZmllZENvdW50IiwiY3JlYXRlVHJhbnNjcmlwdENodW5rcyIsImNodW5rc0RhdGEiLCJsZW5ndGgiLCJjaHVua3NUb0luc2VydCIsIm1hcCIsImNodW5rIiwiZGVsZXRlTWFueSIsImluc2VydE1hbnkiLCJpbnNlcnRlZENvdW50IiwiZ2V0VHJhbnNjcmlwdENodW5rcyIsImZpbmQiLCJzb3J0Iiwic3RhcnRUaW1lc3RhbXAiLCJ0b0FycmF5IiwidXBkYXRlVHJhbnNjcmlwdENodW5rRW1iZWRkaW5ncyIsImVtYmVkZGluZyIsImdldENhY2hlZFFBUmVzcG9uc2UiLCJub3JtYWxpemVkUXVlc3Rpb25UZXh0IiwicmVzcG9uc2UiLCJnZXRDYWNoZWRQcm9hY3RpdmVBbmFseXNpcyIsInNhdmVRQVJlc3BvbnNlIiwicXVlc3Rpb25PckFuYWx5c2lzVHlwZSIsInJlc3BvbnNlVGV4dCIsIm5vdyIsImZpbHRlciIsInVwZGF0ZURhdGEiLCIkc2V0T25JbnNlcnQiLCJ1cHNlcnQiLCJjbG9zZURhdGFiYXNlQ29ubmVjdGlvbiIsImNsb3NlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/mongodb.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/youtube.ts":
/*!****************************!*\
  !*** ./src/lib/youtube.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   extractVideoId: () => (/* binding */ extractVideoId),\n/* harmony export */   getVideoDetails: () => (/* binding */ getVideoDetails),\n/* harmony export */   getYouTubeTranscript: () => (/* binding */ getYouTubeTranscript),\n/* harmony export */   isValidYouTubeUrl: () => (/* binding */ isValidYouTubeUrl)\n/* harmony export */ });\n/* harmony import */ var youtube_transcript__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! youtube-transcript */ \"(rsc)/./node_modules/youtube-transcript/dist/youtube-transcript.esm.js\");\n\nfunction isValidYouTubeUrl(url) {\n    const patterns = [\n        /^(?:https?:\\/\\/)?(?:www\\.)?(?:youtube\\.com\\/watch\\?v=)([a-zA-Z0-9_-]{11})(?:&[^&\\n]*)?$/,\n        /^(?:https?:\\/\\/)?(?:www\\.)?(?:youtu\\.be\\/)([a-zA-Z0-9_-]{11})(?:\\?[^&\\n]*)?$/,\n        /^(?:https?:\\/\\/)?(?:www\\.)?youtube\\.com\\/embed\\/([a-zA-Z0-9_-]{11})/,\n        /^(?:https?:\\/\\/)?(?:www\\.)?youtube\\.com\\/v\\/([a-zA-Z0-9_-]{11})/\n    ];\n    return patterns.some((pattern)=>pattern.test(url));\n}\nfunction extractVideoId(url) {\n    const patterns = [\n        /(?:youtube\\.com\\/watch\\?v=)([^&\\n?#]+)/,\n        /(?:youtu\\.be\\/)([^&\\n?#]+)/,\n        /youtube\\.com\\/embed\\/([^&\\n?#]+)/,\n        /youtube\\.com\\/v\\/([^&\\n?#]+)/\n    ];\n    for (const pattern of patterns){\n        const match = url.match(pattern);\n        if (match && match[1]) {\n            return match[1];\n        }\n    }\n    return null;\n}\nasync function getVideoDetails(videoId) {\n    try {\n        const response = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${process.env.YOUTUBE_API_KEY}`);\n        if (!response.ok) {\n            throw new Error(\"Failed to fetch video details\");\n        }\n        const data = await response.json();\n        if (!data.items?.[0]) {\n            throw new Error(\"Video not found\");\n        }\n        const video = data.items[0];\n        return {\n            title: video.snippet?.title,\n            description: video.snippet?.description,\n            channelTitle: video.snippet?.channelTitle,\n            publishedAt: video.snippet?.publishedAt\n        };\n    } catch (error) {\n        console.error(\"Error fetching video details:\", error);\n        throw error;\n    }\n}\nasync function getYouTubeTranscript(videoUrl) {\n    try {\n        // Extract video ID from URL\n        const videoId = extractVideoId(videoUrl);\n        if (!videoId) {\n            throw new Error(\"Invalid YouTube URL\");\n        }\n        // Try to fetch transcript using youtube-transcript first\n        try {\n            const transcript = await youtube_transcript__WEBPACK_IMPORTED_MODULE_0__.YoutubeTranscript.fetchTranscript(videoId, {\n                lang: \"en\"\n            });\n            if (!transcript || transcript.length === 0) {\n                console.error(\"No transcript found for video:\", videoId);\n                return null;\n            }\n            // Transform to our format\n            return transcript.map((segment)=>({\n                    text: segment.text,\n                    start: segment.offset,\n                    duration: segment.duration\n                }));\n        } catch (transcriptError) {\n            console.error(\"Error fetching transcript with youtube-transcript:\", transcriptError);\n            // If youtube-transcript fails, try to fetch captions directly\n            const captionsResponse = await fetch(`https://www.googleapis.com/youtube/v3/captions?part=snippet&videoId=${videoId}&key=${process.env.YOUTUBE_API_KEY}`);\n            if (!captionsResponse.ok) {\n                const error = await captionsResponse.json();\n                if (error.error?.code === 403) {\n                    throw new Error(\"This video has captions disabled or restricted. Please try a different video with captions enabled.\");\n                }\n                throw new Error(\"Failed to check video captions availability.\");\n            }\n            const captionsData = await captionsResponse.json();\n            if (!captionsData.items || captionsData.items.length === 0) {\n                throw new Error(\"No captions found for this video. Please try a different video with captions enabled.\");\n            }\n            // Get the first available caption track\n            const captionId = captionsData.items[0].id;\n            const captionResponse = await fetch(`https://www.googleapis.com/youtube/v3/captions/${captionId}?key=${process.env.YOUTUBE_API_KEY}`, {\n                headers: {\n                    \"Authorization\": `Bearer ${process.env.YOUTUBE_API_KEY}`,\n                    \"Accept\": \"application/json\"\n                }\n            });\n            if (!captionResponse.ok) {\n                throw new Error(\"Failed to fetch video captions. Please try a different video.\");\n            }\n            const captionData = await captionResponse.json();\n            // Parse the caption data and transform it to our format\n            return captionData.items.map((item)=>({\n                    text: item.text,\n                    start: item.start,\n                    duration: item.duration\n                }));\n        }\n    } catch (error) {\n        console.error(\"Error fetching YouTube transcript:\", error);\n        if (error instanceof Error) {\n            if (error.message.includes(\"Could not get the transcript\")) {\n                throw new Error(\"This video does not have captions available. Please try a different video with captions enabled.\");\n            } else if (error.message.includes(\"Transcript is disabled\")) {\n                throw new Error(\"This video has captions disabled. Please try a different video with captions enabled.\");\n            } else if (error.message.includes(\"Video is private\")) {\n                throw new Error(\"This video is private. Please try a public video.\");\n            } else if (error.message.includes(\"Video is restricted\")) {\n                throw new Error(\"This video is restricted. Please try a different video.\");\n            }\n        }\n        throw new Error(\"Failed to fetch transcript. Please try a different video.\");\n    }\n}\nfunction formatTimestamp(seconds) {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor(seconds % 3600 / 60);\n    const remainingSeconds = Math.floor(seconds % 60);\n    return [\n        hours.toString().padStart(2, \"0\"),\n        minutes.toString().padStart(2, \"0\"),\n        remainingSeconds.toString().padStart(2, \"0\")\n    ].join(\":\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU0sSUFBSW5DLE1BQU07WUFDbEIsT0FBTyxJQUFJVSxNQUFNd0IsT0FBTyxDQUFDQyxRQUFRLENBQUMsd0JBQXdCO2dCQUN4RCxNQUFNLElBQUluQyxNQUFNO1lBQ2xCO1FBQ0Y7UUFDQSxNQUFNLElBQUlBLE1BQU07SUFDbEI7QUFDRjtBQUVBLFNBQVNvQyxnQkFBZ0JDLE9BQWU7SUFDdEMsTUFBTUMsUUFBUUMsS0FBS0MsS0FBSyxDQUFDSCxVQUFVO0lBQ25DLE1BQU1JLFVBQVVGLEtBQUtDLEtBQUssQ0FBQyxVQUFXLE9BQVE7SUFDOUMsTUFBTUUsbUJBQW1CSCxLQUFLQyxLQUFLLENBQUNILFVBQVU7SUFFOUMsT0FBTztRQUNMQyxNQUFNSyxRQUFRLEdBQUdDLFFBQVEsQ0FBQyxHQUFHO1FBQzdCSCxRQUFRRSxRQUFRLEdBQUdDLFFBQVEsQ0FBQyxHQUFHO1FBQy9CRixpQkFBaUJDLFFBQVEsR0FBR0MsUUFBUSxDQUFDLEdBQUc7S0FDekMsQ0FBQ0MsSUFBSSxDQUFDO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jaGF0cHllLy4vc3JjL2xpYi95b3V0dWJlLnRzP2Y2OGQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgWW91dHViZVRyYW5zY3JpcHQgfSBmcm9tICd5b3V0dWJlLXRyYW5zY3JpcHQnO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzVmFsaWRZb3VUdWJlVXJsKHVybDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgY29uc3QgcGF0dGVybnMgPSBbXHJcbiAgICAvXig/Omh0dHBzPzpcXC9cXC8pPyg/Ond3d1xcLik/KD86eW91dHViZVxcLmNvbVxcL3dhdGNoXFw/dj0pKFthLXpBLVowLTlfLV17MTF9KSg/OiZbXiZcXG5dKik/JC8sXHJcbiAgICAvXig/Omh0dHBzPzpcXC9cXC8pPyg/Ond3d1xcLik/KD86eW91dHVcXC5iZVxcLykoW2EtekEtWjAtOV8tXXsxMX0pKD86XFw/W14mXFxuXSopPyQvLFxyXG4gICAgL14oPzpodHRwcz86XFwvXFwvKT8oPzp3d3dcXC4pP3lvdXR1YmVcXC5jb21cXC9lbWJlZFxcLyhbYS16QS1aMC05Xy1dezExfSkvLFxyXG4gICAgL14oPzpodHRwcz86XFwvXFwvKT8oPzp3d3dcXC4pP3lvdXR1YmVcXC5jb21cXC92XFwvKFthLXpBLVowLTlfLV17MTF9KS9cclxuICBdXHJcbiAgcmV0dXJuIHBhdHRlcm5zLnNvbWUocGF0dGVybiA9PiBwYXR0ZXJuLnRlc3QodXJsKSlcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RWaWRlb0lkKHVybDogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCB7XHJcbiAgY29uc3QgcGF0dGVybnMgPSBbXHJcbiAgICAvKD86eW91dHViZVxcLmNvbVxcL3dhdGNoXFw/dj0pKFteJlxcbj8jXSspLyxcclxuICAgIC8oPzp5b3V0dVxcLmJlXFwvKShbXiZcXG4/I10rKS8sXHJcbiAgICAveW91dHViZVxcLmNvbVxcL2VtYmVkXFwvKFteJlxcbj8jXSspLyxcclxuICAgIC95b3V0dWJlXFwuY29tXFwvdlxcLyhbXiZcXG4/I10rKS9cclxuICBdXHJcbiAgXHJcbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHBhdHRlcm5zKSB7XHJcbiAgICBjb25zdCBtYXRjaCA9IHVybC5tYXRjaChwYXR0ZXJuKVxyXG4gICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdKSB7XHJcbiAgICAgIHJldHVybiBtYXRjaFsxXVxyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICByZXR1cm4gbnVsbFxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VmlkZW9EZXRhaWxzKHZpZGVvSWQ6IHN0cmluZykge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxyXG4gICAgICBgaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20veW91dHViZS92My92aWRlb3M/cGFydD1zbmlwcGV0JmlkPSR7dmlkZW9JZH0ma2V5PSR7cHJvY2Vzcy5lbnYuWU9VVFVCRV9BUElfS0VZfWBcclxuICAgIClcclxuXHJcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBmZXRjaCB2aWRlbyBkZXRhaWxzXCIpXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxyXG5cclxuICAgIGlmICghZGF0YS5pdGVtcz8uWzBdKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlZpZGVvIG5vdCBmb3VuZFwiKVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHZpZGVvID0gZGF0YS5pdGVtc1swXVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdGl0bGU6IHZpZGVvLnNuaXBwZXQ/LnRpdGxlLFxyXG4gICAgICBkZXNjcmlwdGlvbjogdmlkZW8uc25pcHBldD8uZGVzY3JpcHRpb24sXHJcbiAgICAgIGNoYW5uZWxUaXRsZTogdmlkZW8uc25pcHBldD8uY2hhbm5lbFRpdGxlLFxyXG4gICAgICBwdWJsaXNoZWRBdDogdmlkZW8uc25pcHBldD8ucHVibGlzaGVkQXQsXHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyB2aWRlbyBkZXRhaWxzOlwiLCBlcnJvcilcclxuICAgIHRocm93IGVycm9yXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFRyYW5zY3JpcHRTZWdtZW50IHtcclxuICB0ZXh0OiBzdHJpbmc7XHJcbiAgc3RhcnQ6IG51bWJlcjtcclxuICBkdXJhdGlvbjogbnVtYmVyO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0WW91VHViZVRyYW5zY3JpcHQodmlkZW9Vcmw6IHN0cmluZyk6IFByb21pc2U8VHJhbnNjcmlwdFNlZ21lbnRbXSB8IG51bGw+IHtcclxuICB0cnkge1xyXG4gICAgLy8gRXh0cmFjdCB2aWRlbyBJRCBmcm9tIFVSTFxyXG4gICAgY29uc3QgdmlkZW9JZCA9IGV4dHJhY3RWaWRlb0lkKHZpZGVvVXJsKTtcclxuICAgIGlmICghdmlkZW9JZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgWW91VHViZSBVUkwnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUcnkgdG8gZmV0Y2ggdHJhbnNjcmlwdCB1c2luZyB5b3V0dWJlLXRyYW5zY3JpcHQgZmlyc3RcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHRyYW5zY3JpcHQgPSBhd2FpdCBZb3V0dWJlVHJhbnNjcmlwdC5mZXRjaFRyYW5zY3JpcHQodmlkZW9JZCwge1xyXG4gICAgICAgIGxhbmc6ICdlbidcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIXRyYW5zY3JpcHQgfHwgdHJhbnNjcmlwdC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdObyB0cmFuc2NyaXB0IGZvdW5kIGZvciB2aWRlbzonLCB2aWRlb0lkKTtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gVHJhbnNmb3JtIHRvIG91ciBmb3JtYXRcclxuICAgICAgcmV0dXJuIHRyYW5zY3JpcHQubWFwKHNlZ21lbnQgPT4gKHtcclxuICAgICAgICB0ZXh0OiBzZWdtZW50LnRleHQsXHJcbiAgICAgICAgc3RhcnQ6IHNlZ21lbnQub2Zmc2V0LFxyXG4gICAgICAgIGR1cmF0aW9uOiBzZWdtZW50LmR1cmF0aW9uXHJcbiAgICAgIH0pKTtcclxuICAgIH0gY2F0Y2ggKHRyYW5zY3JpcHRFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyB0cmFuc2NyaXB0IHdpdGggeW91dHViZS10cmFuc2NyaXB0OicsIHRyYW5zY3JpcHRFcnJvcik7XHJcbiAgICAgIFxyXG4gICAgICAvLyBJZiB5b3V0dWJlLXRyYW5zY3JpcHQgZmFpbHMsIHRyeSB0byBmZXRjaCBjYXB0aW9ucyBkaXJlY3RseVxyXG4gICAgICBjb25zdCBjYXB0aW9uc1Jlc3BvbnNlID0gYXdhaXQgZmV0Y2goXHJcbiAgICAgICAgYGh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3lvdXR1YmUvdjMvY2FwdGlvbnM/cGFydD1zbmlwcGV0JnZpZGVvSWQ9JHt2aWRlb0lkfSZrZXk9JHtwcm9jZXNzLmVudi5ZT1VUVUJFX0FQSV9LRVl9YFxyXG4gICAgICApO1xyXG5cclxuICAgICAgaWYgKCFjYXB0aW9uc1Jlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSBhd2FpdCBjYXB0aW9uc1Jlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICBpZiAoZXJyb3IuZXJyb3I/LmNvZGUgPT09IDQwMykge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIHZpZGVvIGhhcyBjYXB0aW9ucyBkaXNhYmxlZCBvciByZXN0cmljdGVkLiBQbGVhc2UgdHJ5IGEgZGlmZmVyZW50IHZpZGVvIHdpdGggY2FwdGlvbnMgZW5hYmxlZC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gY2hlY2sgdmlkZW8gY2FwdGlvbnMgYXZhaWxhYmlsaXR5LicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBjYXB0aW9uc0RhdGEgPSBhd2FpdCBjYXB0aW9uc1Jlc3BvbnNlLmpzb24oKTtcclxuICAgICAgaWYgKCFjYXB0aW9uc0RhdGEuaXRlbXMgfHwgY2FwdGlvbnNEYXRhLml0ZW1zLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gY2FwdGlvbnMgZm91bmQgZm9yIHRoaXMgdmlkZW8uIFBsZWFzZSB0cnkgYSBkaWZmZXJlbnQgdmlkZW8gd2l0aCBjYXB0aW9ucyBlbmFibGVkLicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBHZXQgdGhlIGZpcnN0IGF2YWlsYWJsZSBjYXB0aW9uIHRyYWNrXHJcbiAgICAgIGNvbnN0IGNhcHRpb25JZCA9IGNhcHRpb25zRGF0YS5pdGVtc1swXS5pZDtcclxuICAgICAgY29uc3QgY2FwdGlvblJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXHJcbiAgICAgICAgYGh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3lvdXR1YmUvdjMvY2FwdGlvbnMvJHtjYXB0aW9uSWR9P2tleT0ke3Byb2Nlc3MuZW52LllPVVRVQkVfQVBJX0tFWX1gLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7cHJvY2Vzcy5lbnYuWU9VVFVCRV9BUElfS0VZfWAsXHJcbiAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICk7XHJcblxyXG4gICAgICBpZiAoIWNhcHRpb25SZXNwb25zZS5vaykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGZldGNoIHZpZGVvIGNhcHRpb25zLiBQbGVhc2UgdHJ5IGEgZGlmZmVyZW50IHZpZGVvLicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBjYXB0aW9uRGF0YSA9IGF3YWl0IGNhcHRpb25SZXNwb25zZS5qc29uKCk7XHJcbiAgICAgIC8vIFBhcnNlIHRoZSBjYXB0aW9uIGRhdGEgYW5kIHRyYW5zZm9ybSBpdCB0byBvdXIgZm9ybWF0XHJcbiAgICAgIHJldHVybiBjYXB0aW9uRGF0YS5pdGVtcy5tYXAoKGl0ZW06IGFueSkgPT4gKHtcclxuICAgICAgICB0ZXh0OiBpdGVtLnRleHQsXHJcbiAgICAgICAgc3RhcnQ6IGl0ZW0uc3RhcnQsXHJcbiAgICAgICAgZHVyYXRpb246IGl0ZW0uZHVyYXRpb25cclxuICAgICAgfSkpO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBZb3VUdWJlIHRyYW5zY3JpcHQ6JywgZXJyb3IpO1xyXG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgaWYgKGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ0NvdWxkIG5vdCBnZXQgdGhlIHRyYW5zY3JpcHQnKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyB2aWRlbyBkb2VzIG5vdCBoYXZlIGNhcHRpb25zIGF2YWlsYWJsZS4gUGxlYXNlIHRyeSBhIGRpZmZlcmVudCB2aWRlbyB3aXRoIGNhcHRpb25zIGVuYWJsZWQuJyk7XHJcbiAgICAgIH0gZWxzZSBpZiAoZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnVHJhbnNjcmlwdCBpcyBkaXNhYmxlZCcpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIHZpZGVvIGhhcyBjYXB0aW9ucyBkaXNhYmxlZC4gUGxlYXNlIHRyeSBhIGRpZmZlcmVudCB2aWRlbyB3aXRoIGNhcHRpb25zIGVuYWJsZWQuJyk7XHJcbiAgICAgIH0gZWxzZSBpZiAoZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnVmlkZW8gaXMgcHJpdmF0ZScpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIHZpZGVvIGlzIHByaXZhdGUuIFBsZWFzZSB0cnkgYSBwdWJsaWMgdmlkZW8uJyk7XHJcbiAgICAgIH0gZWxzZSBpZiAoZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnVmlkZW8gaXMgcmVzdHJpY3RlZCcpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIHZpZGVvIGlzIHJlc3RyaWN0ZWQuIFBsZWFzZSB0cnkgYSBkaWZmZXJlbnQgdmlkZW8uJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGZldGNoIHRyYW5zY3JpcHQuIFBsZWFzZSB0cnkgYSBkaWZmZXJlbnQgdmlkZW8uJyk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBmb3JtYXRUaW1lc3RhbXAoc2Vjb25kczogbnVtYmVyKTogc3RyaW5nIHtcclxuICBjb25zdCBob3VycyA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDM2MDApO1xyXG4gIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKChzZWNvbmRzICUgMzYwMCkgLyA2MCk7XHJcbiAgY29uc3QgcmVtYWluaW5nU2Vjb25kcyA9IE1hdGguZmxvb3Ioc2Vjb25kcyAlIDYwKTtcclxuXHJcbiAgcmV0dXJuIFtcclxuICAgIGhvdXJzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKSxcclxuICAgIG1pbnV0ZXMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpLFxyXG4gICAgcmVtYWluaW5nU2Vjb25kcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJylcclxuICBdLmpvaW4oJzonKTtcclxufSAiXSwibmFtZXMiOlsiWW91dHViZVRyYW5zY3JpcHQiLCJpc1ZhbGlkWW91VHViZVVybCIsInVybCIsInBhdHRlcm5zIiwic29tZSIsInBhdHRlcm4iLCJ0ZXN0IiwiZXh0cmFjdFZpZGVvSWQiLCJtYXRjaCIsImdldFZpZGVvRGV0YWlscyIsInZpZGVvSWQiLCJyZXNwb25zZSIsImZldGNoIiwicHJvY2VzcyIsImVudiIsIllPVVRVQkVfQVBJX0tFWSIsIm9rIiwiRXJyb3IiLCJkYXRhIiwianNvbiIsIml0ZW1zIiwidmlkZW8iLCJ0aXRsZSIsInNuaXBwZXQiLCJkZXNjcmlwdGlvbiIsImNoYW5uZWxUaXRsZSIsInB1Ymxpc2hlZEF0IiwiZXJyb3IiLCJjb25zb2xlIiwiZ2V0WW91VHViZVRyYW5zY3JpcHQiLCJ2aWRlb1VybCIsInRyYW5zY3JpcHQiLCJmZXRjaFRyYW5zY3JpcHQiLCJsYW5nIiwibGVuZ3RoIiwibWFwIiwic2VnbWVudCIsInRleHQiLCJzdGFydCIsIm9mZnNldCIsImR1cmF0aW9uIiwidHJhbnNjcmlwdEVycm9yIiwiY2FwdGlvbnNSZXNwb25zZSIsImNvZGUiLCJjYXB0aW9uc0RhdGEiLCJjYXB0aW9uSWQiLCJpZCIsImNhcHRpb25SZXNwb25zZSIsImhlYWRlcnMiLCJjYXB0aW9uRGF0YSIsIml0ZW0iLCJtZXNzYWdlIiwiaW5jbHVkZXMiLCJmb3JtYXRUaW1lc3RhbXAiLCJzZWNvbmRzIiwiaG91cnMiLCJNYXRoIiwiZmxvb3IiLCJtaW51dGVzIiwicmVtYWluaW5nU2Vjb25kcyIsInRvU3RyaW5nIiwicGFkU3RhcnQiLCJqb2luIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/youtube.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/youtube-transcript","vendor-chunks/@google","vendor-chunks/uuid"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fvideo%2Fprocess%2Froute&page=%2Fapi%2Fvideo%2Fprocess%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fvideo%2Fprocess%2Froute.ts&appDir=C%3A%5CUsers%5CDeborah%5CDocuments%5CCursor%20Projects%5Cchatpye%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CDeborah%5CDocuments%5CCursor%20Projects%5Cchatpye&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();